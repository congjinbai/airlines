<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èˆªç­ä¿¡æ¯ç”Ÿæˆå™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
        }
        .form-group {
            margin-bottom: 18px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #34495e;
        }
        input, select, textarea {
            width: 100%;
            padding: 9px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            margin-bottom: 6px;
            font-size: 14px;
        }
        select {
            height: 38px;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 15px;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .flight-segment {
            border: 1px solid #ddd;
            padding: 18px;
            margin-bottom: 22px;
            border-radius: 6px;
            position: relative;
            background-color: #f9f9f9;
        }
        .add-segment {
            background-color: #2ecc71;
            margin-bottom: 10px;
            display: block;
        }
        .add-segment:hover {
            background-color: #27ae60;
        }
        .luggage-btn {
            background-color: #9b59b6;
            margin-bottom: 18px;
            display: block;
        }
        .luggage-btn:hover {
            background-color: #8e44ad;
        }
        .remove-segment {
            background-color: #e74c3c;
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 8px;
            font-size: 13px;
        }
        .remove-segment:hover {
            background-color: #c0392b;
        }
        .output {
            margin-top: 25px;
            white-space: pre-wrap;
            background-color: #f0f7ff;
            padding: 18px;
            border-radius: 6px;
            border: 1px solid #d6e4f0;
            font-family: Consolas, monospace;
            line-height: 1.5;
        }
        .copy-btn {
            background-color: #9b59b6;
            margin-top: 12px;
        }
        .copy-btn:hover {
            background-color: #8e44ad;
        }
        .flex-row {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }
        .flex-row > div {
            flex: 1;
        }
        .time-input {
            position: relative;
        }
        .time-input input {
            padding-right: 40px;
            min-width: 120px;
        }
        .auto-fill-btn {
            background-color: #f39c12;
            margin-top: 5px;
        }
        .auto-fill-btn:hover {
            background-color: #d35400;
        }
        .luggage-plan {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            background-color: #f0f0f0;
            position: relative;
        }
        .luggage-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ccc;
        }
        .luggage-row {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            align-items: center;
        }
        .luggage-row select {
            flex: 1;
            min-width: 200px;
        }
        .luggage-row input {
            flex: 1;
            min-width: 100px;
        }
        .section-divider {
            margin: 30px 0;
            border-top: 2px solid #ccc;
            padding-top: 20px;
        }
        .price-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .price-input input {
            width: 100px;
        }
        .flight-no-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .flight-no-prefix {
            width: 80px;
        }
        .flight-no-number {
            flex: 1;
        }
        .city-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .city-select {
            flex: 1;
            min-width: 150px;
        }
        .city-input {
            flex: 1;
            min-width: 150px;
        }
        .time-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .time-input-equal {
            flex: 1;
            height: 38px;
            padding: 9px;
            font-size: 14px;
        }
        .toggle-btn-equal {
            height: 38px;
            padding: 9px;
            font-size: 14px;
            background-color: #e0e0e0;
            color: #333;
            border: 1px solid #ccc;
            box-sizing: border-box;
            text-align: center;
        }
        .toggle-btn-midnight {
            flex: 0.5;
        }
        .toggle-btn-next-day {
            flex: 0.5;
        }
        .toggle-btn-equal.active {
            background-color: #2196f3;
            color: white;
            border-color: #1976d2;
        }
        .toggle-btn-equal:hover {
            background-color: #d0d0d0;
        }
        .toggle-btn-equal.active:hover {
            background-color: #1976d2;
        }
        .notes-container {
            margin-top: 8px;
        }
        .notes-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        .note-tag {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .note-tag:hover {
            background-color: #bbdefb;
        }
        .note-tag.selected {
            background-color: #1976d2;
            color: white;
            border-color: #1565c0;
        }
        .custom-note-input {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        .custom-note-input input {
            flex: 1;
        }
        .add-custom-note {
            background-color: #4caf50;
            padding: 5px 15px;
            font-size: 13px;
            white-space: nowrap;
        }
        .selected-notes-display {
            margin-top: 10px;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            min-height: 30px;
            font-size: 14px;
        }
        .other-info-section {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        .vertical-buttons {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœˆï¸ èˆªç­ä¿¡æ¯ç”Ÿæˆå™¨ âœˆï¸</h1>
        
        <!-- æ–¹æ¡ˆ1åŒºåŸŸ -->
        <div class="other-info-section">
            <div class="section-title">æ–¹æ¡ˆ1</div>
            
            <div class="vertical-buttons">
                <button class="add-segment" onclick="addFlightSegment('above')">+ æ–°èˆªæ®µ1</button>
            </div>
            
            <!-- ä¸Šæ–¹èˆªç­æ®µå®¹å™¨ -->
            <div id="flightSegmentsAbove">
                <!-- ä¸Šæ–¹èˆªç­æ®µå°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
            </div>
            
            <!-- ä¸Šæ–¹æ‰˜è¿æ–¹æ¡ˆå®¹å™¨ -->
            <div id="luggagePlansAbove">
                <!-- ä¸Šæ–¹æ‰˜è¿æ–¹æ¡ˆå°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
        
        <!-- ä¸­é—´åˆ†éš”çº¿ -->
        <div class="section-divider"></div>
        
        <!-- æ–¹æ¡ˆ2åŒºåŸŸ -->
        <div class="other-info-section">
            <div class="section-title">æ–¹æ¡ˆ2</div>
            
            <div class="vertical-buttons">
                <button class="add-segment" onclick="addFlightSegment('middle')">+ æ–°èˆªæ®µ2</button>
            </div>
            
            <!-- ä¸­é—´èˆªç­æ®µå®¹å™¨ -->
            <div id="flightSegmentsMiddle">
                <!-- ä¸­é—´èˆªç­æ®µå°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
            </div>
            
            <!-- ä¸­é—´æ‰˜è¿æ–¹æ¡ˆå®¹å™¨ -->
            <div id="luggagePlansMiddle">
                <!-- ä¸­é—´æ‰˜è¿æ–¹æ¡ˆå°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
        
        <!-- ä¸­é—´åˆ†éš”çº¿ -->
        <div class="section-divider"></div>
        
        <!-- æ–¹æ¡ˆ3åŒºåŸŸ -->
        <div class="other-info-section">
            <div class="section-title">æ–¹æ¡ˆ3</div>
            
            <div class="vertical-buttons">
                <button class="add-segment" onclick="addFlightSegment('below')">+ æ–°èˆªæ®µ3</button>
            </div>
            
            <!-- ä¸‹æ–¹èˆªç­æ®µå®¹å™¨ -->
            <div id="flightSegmentsBelow">
                <!-- ä¸‹æ–¹èˆªç­æ®µå°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
            </div>
            
            <!-- ä¸‹æ–¹æ‰˜è¿æ–¹æ¡ˆå®¹å™¨ -->
            <div id="luggagePlansBelow">
                <!-- ä¸‹æ–¹æ‰˜è¿æ–¹æ¡ˆå°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
        
        <div style="margin-top: 25px; text-align: center;">
            <button onclick="generateMessage()" style="background-color: #2ecc71;">ç”Ÿæˆè¡¨å•</button>
            <button onclick="resetForm()" style="background-color: #e74c3c;">é‡ç½®è¡¨å•</button>
        </div>
        
        <div class="output" id="output"></div>
        <button class="copy-btn" onclick="copyToClipboard()">å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
    </div>

    <script>
        // åŸå¸‚åˆ—è¡¨æ•°æ®
        const cityList = [
            "å¥¥æ–¯", "åŸƒé‡Œæ¸©", "å·´å°”ç‘™å°”", "å¸ƒå¸‚", "å¸ƒæ‹‰æ ¼ç»´ç”³æ–¯å…‹", "è½¦é‡Œé›…å®¾æ–¯å…‹", 
            "æ ¼ç½—å…¹å°¼", "æµ·å‚å´´", "å“ˆå·´", "å“ˆå·´ç½—å¤«æ–¯å…‹", "å…‹æ‹‰æ–¯è¯ºäºšå°”æ–¯å…‹", "å–€å±±", 
            "é©¬å˜æ–¯", "è«æ–¯ç§‘", "åœ£å½¼å¾—å ¡", "ç´¢å¥‘", "æ–°è¥¿ä¼¯åˆ©äºš", "å¶å¡", "å¶å¡æ·ç³å ¡", 
            "åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "è¥¿å®‰", "æ­å·", "æ²ˆé˜³", "å“ˆå°”æ»¨", "é‡åº†", "é’å²›", 
            "æˆéƒ½", "ä¸‰äºš", "æ·±åœ³", "é•¿æ˜¥"
        ];
        
        // é¢„è®¾å¤‡æ³¨é€‰é¡¹
        const presetNotes = [
            "è«æ–¯ç§‘æœºåœºä½ä¸€å¤œ",
            "åœ¨æœºåœºè¦ä½ä¸€å¤œ",
            "è¦ä½ä¸€å¤œ",
            "ä¸ä¸­è½¬æœºåœº",
            "ä¸­è½¬èˆªç«™æ¥¼",
            "æ—…æ¸¸æ—ºå­£æœŸæœºç¥¨ç´§å¼ ï¼Œè¯·æŠ“ç´§å†³å®š",
            "éœ€è¦ä¸­è½¬æœºåœº",
            "éœ€è¦ä¸­è½¬åˆ°è°åŠ£ç­æ¥å¨ƒæœºåœº",
            "éœ€è¦ä¸­è½¬åˆ°ç¦æ€’å˜å“‡æœºåœº",
            "éœ€è¦ä¸­è½¬åˆ°å¤§å¦ˆè§£ç­”å“‡æœºåœº",
            "éš”æ—¥èˆªç­",
            "ä¸éœ€è¦æå–æ‰˜è¿è¡Œæ",
            "éœ€è¦æå–æ‰˜è¿è¡Œæï¼Œé‡æ–°å€¼æœº",
            "æ˜¯å¦æå–è¡Œæï¼Œåœ¨æœºåœºå€¼æœºæ—¶ç¡®è®¤",
            "è½¬èˆªç«™æ¥¼ï¼Œä¸è½¬æœºåœº",
            "è¿‘æœŸèˆªç­ç»å¸¸æ™šç‚¹ï¼Œè€ƒè™‘å½“å‰æƒ…å†µï¼Œå»ºè®®ææ—©ä¸€å¤©åˆ°è«æ–¯ç§‘",
            "è€ƒè™‘å½“å‰å±€åŠ¿ï¼Œå»ºè®®ææ—©ä¸€å¤©åˆ°è«æ–¯ç§‘",
            "ç›®å‰æ­¤è¶Ÿèˆªç­æ¯”è¾ƒç´§å¼ ï¼Œè¯·æŠ“ç´§å†³å®š"
            
        ];
        
        let segmentCount = 0;
        let planCount = 0;
        
        // æ—¥æœŸè‡ªåŠ¨æ ¼å¼åŒ–
        function formatDate(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 4) {
                value = value.substr(0, 4);
            }
            
            if (value.length === 4) {
                input.value = value.substr(0, 2) + 'æœˆ' + value.substr(2, 2) + 'æ—¥';
            }
        }
        
        // æ—¶é—´è‡ªåŠ¨æ ¼å¼åŒ–
        function formatTime(input) {
            const cursorPos = input.selectionStart;
            let value = input.value.replace(/\D/g, '');
            
            if (value.length > 4) {
                value = value.substr(0, 4);
            }
            
            let formattedValue = '';
            if (value.length > 0) {
                formattedValue = value.substr(0, 2);
                if (value.length > 2) {
                    formattedValue += ':' + value.substr(2, 2);
                }
            }
            
            input.value = formattedValue;
            
            let newCursorPos = cursorPos;
            if (value.length > 2 && cursorPos === 2) {
                newCursorPos = 3;
            } else if (value.length > 2 && cursorPos > 2) {
                newCursorPos = cursorPos + 1;
            }
            
            input.setSelectionRange(newCursorPos, newCursorPos);
        }
        
        // èˆªç­å·è‡ªåŠ¨å¤§å†™
        function flightNoToUpper(input) {
            input.value = input.value.toUpperCase();
        }
        
        // æ›´æ–°èˆªç­å·
        function updateFlightNo(prefixId, numberId, outputId) {
            const prefix = document.getElementById(prefixId).value;
            const number = document.getElementById(numberId).value;
            document.getElementById(outputId).value = prefix === 'æ— ' ? number : prefix + number;
        }
        
        // æ›´æ–°åŸå¸‚è¾“å…¥
        function updateCityInput(selectId, inputId, outputId) {
            const selectValue = document.getElementById(selectId).value;
            const inputValue = document.getElementById(inputId).value;
            document.getElementById(outputId).value = selectValue || inputValue;
        }
        
        // åˆ‡æ¢ååŠå¤œé€‰é¡¹çŠ¶æ€ - ä¿®å¤å¤šè¡Œç¨‹æŒ‰é’®é—®é¢˜
        function toggleMidnight(segmentId) {
            // ä½¿ç”¨æ›´å¯é çš„é€‰æ‹©å™¨ç¡®ä¿è·å–æ­£ç¡®çš„æŒ‰é’®
            const btn = document.querySelector(`#segment${segmentId} .toggle-btn-midnight`);
            if (btn) {
                btn.classList.toggle('active');
            }
        }
        
        // åˆ‡æ¢æ¬¡æ—¥1é€‰é¡¹çŠ¶æ€
        function toggleNextDay1(segmentId) {
            const btn = document.querySelector(`#segment${segmentId} .toggle-btn-next-day-1`);
            if (btn) {
                btn.classList.toggle('active');
            }
        }
        
        // åˆ‡æ¢æ¬¡æ—¥é€‰é¡¹çŠ¶æ€
        function toggleNextDay(segmentId) {
            const btn = document.querySelector(`#segment${segmentId} .toggle-btn-next-day`);
            if (btn) {
                btn.classList.toggle('active');
            }
        }
        
        // åˆ‡æ¢å¤‡æ³¨é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
        function toggleNote(planNum, noteText) {
            const selectedNotesInput = document.getElementById(`selectedNotes${planNum}`);
            const selectedNotesDisplay = document.getElementById(`selectedNotesDisplay${planNum}`);
            let selectedNotes = selectedNotesInput.value ? selectedNotesInput.value.split(',') : [];
            
            const index = selectedNotes.indexOf(noteText);
            if (index > -1) {
                selectedNotes.splice(index, 1);
                document.querySelector(`#noteTag${planNum}-${noteText.replace(/\s+/g, '')}`).classList.remove('selected');
            } else {
                selectedNotes.push(noteText);
                document.querySelector(`#noteTag${planNum}-${noteText.replace(/\s+/g, '')}`).classList.add('selected');
            }
            
            selectedNotesInput.value = selectedNotes.join(',');
            selectedNotesDisplay.textContent = selectedNotes.join(', ');
        }
        
        // æ·»åŠ è‡ªå®šä¹‰å¤‡æ³¨
        function addCustomNote(planNum) {
            const customNoteInput = document.getElementById(`customNoteInput${planNum}`);
            const noteText = customNoteInput.value.trim();
            
            if (noteText) {
                const selectedNotesInput = document.getElementById(`selectedNotes${planNum}`);
                const selectedNotesDisplay = document.getElementById(`selectedNotesDisplay${planNum}`);
                let selectedNotes = selectedNotesInput.value ? selectedNotesInput.value.split(',') : [];
                
                if (!selectedNotes.includes(noteText)) {
                    selectedNotes.push(noteText);
                    selectedNotesInput.value = selectedNotes.join(',');
                    selectedNotesDisplay.textContent = selectedNotes.join(', ');
                    customNoteInput.value = '';
                }
            }
        }
        
        // æ·»åŠ èˆªç­æ®µå‡½æ•°
        function addFlightSegment(position) {
            segmentCount++;
            const containerId = position === 'above' ? 'flightSegmentsAbove' : 
                               position === 'middle' ? 'flightSegmentsMiddle' : 'flightSegmentsBelow';
            const container = document.getElementById(containerId);
            
            // å…ˆç§»é™¤å®¹å™¨ä¸­å·²æœ‰çš„æ‰˜è¿æŒ‰é’®
            const existingBtns = container.querySelectorAll('.luggage-btn');
            existingBtns.forEach(btn => btn.remove());
            
            const segmentDiv = document.createElement('div');
            segmentDiv.className = 'flight-segment';
            segmentDiv.id = `segment${segmentCount}`;  // ç¡®ä¿IDå”¯ä¸€
            segmentDiv.dataset.position = position;
            segmentDiv.dataset.segmentId = segmentCount;  // æ·»åŠ æ•°æ®å±æ€§ç”¨äºè¯†åˆ«
            
            segmentDiv.innerHTML = `
                <button class="remove-segment" onclick="removeSegment('segment${segmentCount}')">Ã— åˆ é™¤</button>
                
                <div class="flex-row">
                    <div class="form-group">
                        <label>èµ·é£æ—¥æœŸ:</label>
                        <input type="text" id="segment${segmentCount}-date" placeholder="ä¾‹å¦‚: 0802" 
                               oninput="formatDate(this)" maxlength="4">
                    </div>
                    <div class="form-group">
                        <label>èˆªç­å·:</label>
                        <div class="flight-no-container">
                            <select id="segment${segmentCount}-flightNoPrefix" class="flight-no-prefix"
                                    onchange="updateFlightNo('segment${segmentCount}-flightNoPrefix', 'segment${segmentCount}-flightNoNumber', 'segment${segmentCount}-flightNo')">
                                <option value="æ— ">æ— </option>
                                <option value="SU-">SU-</option>
                                <option value="DP-">DP-</option>
                                <option value="U6-">U6-</option>
                                <option value="S7-">S7-</option>
                                <option value="UT-">UT-</option>
                                <option value="WZ-">WZ-</option>
                                <option value="IO-">IO-</option>
                                <option value="N4-">N4-</option>
                                <option value="YC-">YC-</option>
                                <option value="HZ-">HZ-</option>
                                <option value="5N-">5N-</option>
                                <option value="A4-">A4-</option>
                                <option value="3U-">3U-</option>
                                <option value="CA-">CA-</option>
                                <option value="JD-">JD-</option>
                                <option value="MU-">MU-</option>
                                <option value="GS-">GS-</option>
                                <option value="CZ-">CZ-</option>
                            </select>
                            <input type="text" id="segment${segmentCount}-flightNoNumber" class="flight-no-number" 
                                   placeholder="èˆªç­å·" oninput="flightNoToUpper(this); updateFlightNo('segment${segmentCount}-flightNoPrefix', 'segment${segmentCount}-flightNoNumber', 'segment${segmentCount}-flightNo')">
                        </div>
                        <input type="hidden" id="segment${segmentCount}-flightNo">
                    </div>
                </div>
                
                <button class="auto-fill-btn" onclick="autoFillFlightInfo('segment${segmentCount}')">è‡ªåŠ¨å¡«å†™èˆªç­ä¿¡æ¯</button>
                
                <div class="flex-row">
                    <div class="form-group">
                        <label>å‡ºå‘åŸå¸‚:</label>
                        <div class="city-input-container">
                            <select id="segment${segmentCount}-from-select" class="city-select"
                                    onchange="updateCityInput('segment${segmentCount}-from-select', 'segment${segmentCount}-from-input', 'segment${segmentCount}-from')">
                                <option value="">é€‰æ‹©åŸå¸‚</option>
                            </select>
                            <input type="text" id="segment${segmentCount}-from-input" class="city-input" 
                                   placeholder="æ‰‹åŠ¨è¾“å…¥" oninput="updateCityInput('segment${segmentCount}-from-select', 'segment${segmentCount}-from-input', 'segment${segmentCount}-from')">
                        </div>
                        <input type="hidden" id="segment${segmentCount}-from">
                    </div>
                    <div class="form-group">
                        <label>èµ·é£æ—¶é—´:</label>
                        <div class="time-input-container">
                            <input type="text" id="segment${segmentCount}-departureTime" class="time-input-equal" 
                                   placeholder="ä¾‹å¦‚: 0820" oninput="formatTime(this)" maxlength="5">
                            <!-- ä½¿ç”¨ç±»é€‰æ‹©å™¨è€ŒéIDï¼Œé¿å…IDå†²çª -->
                            <button type="button" class="toggle-btn-equal toggle-btn-midnight"
                                    onclick="toggleMidnight(${segmentCount})">
                                ååŠå¤œ
                            </button>
                            <button type="button" class="toggle-btn-equal toggle-btn-next-day"
                                    onclick="toggleNextDay(${segmentCount})">
                                æ¬¡æ—¥
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="flex-row">
                    <div class="form-group">
                        <label>åˆ°è¾¾åŸå¸‚:</label>
                        <div class="city-input-container">
                            <select id="segment${segmentCount}-to-select" class="city-select"
                                    onchange="updateCityInput('segment${segmentCount}-to-select', 'segment${segmentCount}-to-input', 'segment${segmentCount}-to')">
                                <option value="">é€‰æ‹©åŸå¸‚</option>
                            </select>
                            <input type="text" id="segment${segmentCount}-to-input" class="city-input" 
                                   placeholder="æ‰‹åŠ¨è¾“å…¥" oninput="updateCityInput('segment${segmentCount}-to-select', 'segment${segmentCount}-to-input', 'segment${segmentCount}-to')">
                        </div>
                        <input type="hidden" id="segment${segmentCount}-to">
                    </div>
                    <div class="form-group">
                        <label>æŠµè¾¾æ—¶é—´:</label>
                        <div class="time-input-container">
                            <input type="text" id="segment${segmentCount}-arrivalTime" class="time-input-equal" 
                                   placeholder="ä¾‹å¦‚: 1020" oninput="formatTime(this)" maxlength="5">
                            <button type="button" class="toggle-btn-equal toggle-btn-next-day-1"
                                    onclick="toggleNextDay1(${segmentCount})">
                                æ¬¡æ—¥1
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(segmentDiv);
            
            // æ·»åŠ æ‰˜è¿ä¿¡æ¯æŒ‰é’®
            const luggageBtn = document.createElement('button');
            luggageBtn.className = 'luggage-btn';
            luggageBtn.textContent = '+ æ·»åŠ æ‰˜è¿ä¿¡æ¯';
            luggageBtn.onclick = function() { addLuggagePlan(position); };
            container.appendChild(luggageBtn);
            
            // å¡«å……å‡ºå‘åŸå¸‚é€‰æ‹©æ¡†
            const fromSelect = document.getElementById(`segment${segmentCount}-from-select`);
            cityList.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                fromSelect.appendChild(option);
            });
            
            // å¡«å……åˆ°è¾¾åŸå¸‚é€‰æ‹©æ¡†
            const toSelect = document.getElementById(`segment${segmentCount}-to-select`);
            cityList.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                toSelect.appendChild(option);
            });
        }
        
        // æ·»åŠ æ‰˜è¿æ–¹æ¡ˆå‡½æ•°
        function addLuggagePlan(position) {
            planCount++;
            const containerId = position === 'above' ? 'luggagePlansAbove' : 
                               position === 'middle' ? 'luggagePlansMiddle' : 'luggagePlansBelow';
            const container = document.getElementById(containerId);
            
            // åˆ›å»ºå¤‡æ³¨é€‰é¡¹çš„HTML
            let notesOptionsHtml = '';
            presetNotes.forEach(note => {
                const noteId = note.replace(/\s+/g, '');
                notesOptionsHtml += `
                    <div class="note-tag" id="noteTag${planCount}-${noteId}" 
                         onclick="toggleNote(${planCount}, '${note}')">${note}</div>
                `;
            });
            
            const planDiv = document.createElement('div');
            planDiv.className = 'luggage-plan';
            planDiv.id = 'plan' + planCount;
            planDiv.dataset.position = position;
            
            planDiv.innerHTML = `
                <button class="remove-segment" onclick="removePlan('plan${planCount}')" style="background-color: #9b59b6;">Ã— åˆ é™¤</button>
                
                <div class="luggage-row">
                    <select id="plan${planCount}-luggage">
                        <option value="æ— " selected>æ‰˜è¿é€‰é¡¹</option>
                        <option value="å¸¦æ‰˜è¿">å¸¦æ‰˜è¿</option>
                        <option value="å¸¦æ‰˜è¿åŠ ">å¸¦æ‰˜è¿åŠ </option>
                        <option value="æ— æ‰˜è¿">æ— æ‰˜è¿</option>
                        <option value="æ— æ‰˜è¿å‡">æ— æ‰˜è¿å‡</option>
                        <option value="æ‰˜è¿è´¹">æ‰˜è¿è´¹</option>
                        <option value="å¸¦1ä»¶20å…¬æ–¤æ‰˜è¿">å¸¦1ä»¶20å…¬æ–¤æ‰˜è¿</option>
                        <option value="å¸¦1ä»¶23å…¬æ–¤æ‰˜è¿">å¸¦1ä»¶23å…¬æ–¤æ‰˜è¿</option>
                        <option value="åŠ 1ä»¶20å…¬æ–¤æ‰˜è¿">åŠ 1ä»¶20å…¬æ–¤æ‰˜è¿</option>
                        <option value="åŠ 1ä»¶23å…¬æ–¤æ‰˜è¿">åŠ 1ä»¶23å…¬æ–¤æ‰˜è¿</option>
                    </select>
                    <input type="text" id="plan${planCount}-price" placeholder="ä»·æ ¼">
                </div>
                
                <div class="luggage-details">
                    <div class="form-group">
                        <label for="handLuggage${planCount}">æ‰‹æè¡Œæ:</label>
                        <select id="handLuggage${planCount}">
                            <option value="" selected>æ‰‹æé€‰é¡¹</option>
                            <option value="â—ï¸å°ºå¯¸è¦æ±‚ä¸¥æ ¼36*30*27å˜ç±³">â—ï¸å°ºå¯¸è¦æ±‚ä¸¥æ ¼36*30*27å˜ç±³</option>
                            <option value="â—ï¸å°ºå¯¸è¦æ±‚ä¸¥æ ¼40*30*20å˜ç±³">â—ï¸å°ºå¯¸è¦æ±‚ä¸¥æ ¼40*30*20å˜ç±³</option>
                            <option value="10å…¬æ–¤">10å…¬æ–¤</option>
                            <option value="7å…¬æ–¤">7å…¬æ–¤</option>
                            <option value="5å…¬æ–¤">5å…¬æ–¤</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>å¤‡æ³¨ä¿¡æ¯ (ç‚¹å‡»é€‰æ‹©ï¼Œå¯å¤šé€‰):</label>
                        <div class="notes-options">
                            ${notesOptionsHtml}
                        </div>
                        <div class="custom-note-input">
                            <input type="text" id="customNoteInput${planCount}" placeholder="è¾“å…¥è‡ªå®šä¹‰å¤‡æ³¨">
                            <button type="button" class="add-custom-note" onclick="addCustomNote(${planCount})">æ·»åŠ </button>
                        </div>
                        <div class="selected-notes-display" id="selectedNotesDisplay${planCount}">
                        </div>
                        <input type="hidden" id="selectedNotes${planCount}" value="">
                    </div>
                </div>
            `;
            
            container.appendChild(planDiv);
            
            // è·å–å¯¹åº”çš„èˆªç­æ®µå®¹å™¨
            const flightContainerId = position === 'above' ? 'flightSegmentsAbove' : 
                                    position === 'middle' ? 'flightSegmentsMiddle' : 'flightSegmentsBelow';
            const flightContainer = document.getElementById(flightContainerId);
            
            // æ›´æ–°æ‰˜è¿æŒ‰é’®ä½ç½®
            if (flightContainer.children.length > 0) {
                const existingBtns = flightContainer.querySelectorAll('.luggage-btn');
                existingBtns.forEach(btn => btn.remove());
                
                const luggageBtn = document.createElement('button');
                luggageBtn.className = 'luggage-btn';
                luggageBtn.textContent = '+ æ·»åŠ æ‰˜è¿ä¿¡æ¯';
                luggageBtn.onclick = function() { addLuggagePlan(position); };
                flightContainer.appendChild(luggageBtn);
            }
        }
        
        function removeSegment(id) {
            const segment = document.getElementById(id);
            if (segment) {
                const position = segment.dataset.position;
                segment.remove();
                
                const containerId = position === 'above' ? 'flightSegmentsAbove' : 
                                   position === 'middle' ? 'flightSegmentsMiddle' : 'flightSegmentsBelow';
                const container = document.getElementById(containerId);
                
                // ç§»é™¤æ‰€æœ‰æ‰˜è¿æŒ‰é’®
                const existingBtns = container.querySelectorAll('.luggage-btn');
                existingBtns.forEach(btn => btn.remove());
                
                // å¦‚æœè¿˜æœ‰èˆªç­æ®µï¼Œåœ¨æœ€åä¸€ä¸ªèˆªç­æ®µä¸‹æ–¹æ·»åŠ æ‰˜è¿æŒ‰é’®
                if (container.children.length > 0) {
                    const luggageBtn = document.createElement('button');
                    luggageBtn.className = 'luggage-btn';
                    luggageBtn.textContent = '+ æ·»åŠ æ‰˜è¿ä¿¡æ¯';
                    luggageBtn.onclick = function() { addLuggagePlan(position); };
                    container.appendChild(luggageBtn);
                }
            }
        }
        
        function removePlan(id) {
            const plan = document.getElementById(id);
            if (plan) {
                plan.remove();
            }
        }
        
        function autoFillFlightInfo(segmentId) {
            const flightNo = document.getElementById(`${segmentId}-flightNo`).value;
            const date = document.getElementById(`${segmentId}-date`).value;
            
            if (flightNo && date) {
                alert("è‡ªåŠ¨å¡«å†™åŠŸèƒ½éœ€è¦é›†æˆèˆªç­ä¿¡æ¯API");
            } else {
                alert("è¯·å…ˆè¾“å…¥èˆªç­å·å’Œæ—¥æœŸ");
            }
        }
        
        // å¤„ç†èµ·é£æ—¶é—´ï¼ˆæ ¹æ®æŒ‰é’®çŠ¶æ€æ·»åŠ æ ‡è®°ï¼‰
        function processDepartureTime(date, time, isMidnightActive, isNextDayActive) {
            if (!time) return '';
            
            let result = time;
            
            // æå–æ—¥æœŸä¸­çš„æ—¥éƒ¨åˆ†
            if (isMidnightActive && date) {
                const dayMatch = date.match(/(\d{2})æœˆ(\d{2})æ—¥/);
                if (dayMatch) {
                    const day = parseInt(dayMatch[2]);
                    const previousDay = day - 1;
                    result += `(${previousDay}æ—¥ååŠå¤œ)`;
                } else {
                    result += `(å‰ä¸€æ—¥ååŠå¤œ)`;
                }
            }
            
            // æ·»åŠ æ¬¡æ—¥æ ‡è®°ï¼ˆåœ¨æ—¶é—´å‰ï¼‰
            if (isNextDayActive) {
                result = `æ¬¡æ—¥${result}`;
            }
            
            return result;
        }
        
        // å¤„ç†æŠµè¾¾æ—¶é—´ï¼ˆæ ¹æ®æŒ‰é’®çŠ¶æ€æ·»åŠ æ ‡è®°ï¼‰
        function processArrivalTime(time, isNextDay1Active) {
            if (!time) return '';
            return isNextDay1Active ? `æ¬¡æ—¥${time}` : time;
        }
        
        // è·å–ä¸‹ä¸€æ®µçš„èµ·é£æ—¥æœŸæ˜¾ç¤º
        function getNextDepartureDateDisplay(currentDateInput) {
            // åªæ˜¾ç¤ºç”¨æˆ·è¾“å…¥çš„æ—¥æœŸ
            return currentDateInput;
        }
        
        function generateMessage() {
            // æ”¶é›†å„æ–¹æ¡ˆçš„èˆªç­æ®µå’Œæ‰˜è¿ä¿¡æ¯
            const plans = [
                {
                    name: "æ–¹æ¡ˆ1",
                    segments: Array.from(document.querySelectorAll('#flightSegmentsAbove .flight-segment')),
                    luggagePlans: Array.from(document.querySelectorAll('#luggagePlansAbove .luggage-plan'))
                },
                {
                    name: "æ–¹æ¡ˆ2",
                    segments: Array.from(document.querySelectorAll('#flightSegmentsMiddle .flight-segment')),
                    luggagePlans: Array.from(document.querySelectorAll('#luggagePlansMiddle .luggage-plan'))
                },
                {
                    name: "æ–¹æ¡ˆ3",
                    segments: Array.from(document.querySelectorAll('#flightSegmentsBelow .flight-segment')),
                    luggagePlans: Array.from(document.querySelectorAll('#luggagePlansBelow .flight-segment'))
                }
            ];
            
            // è¿‡æ»¤å‡ºæœ‰èˆªç­æ®µçš„æ–¹æ¡ˆ
            const activePlans = plans.filter(plan => plan.segments.length > 0);
            
            let message = `âœˆï¸èˆªç­æŸ¥è¯¢ç»“æœï¼š\n`;
            
            // å¤„ç†å¤šä¸ªæ–¹æ¡ˆ
            activePlans.forEach((plan, planIndex) => {
                // å¤šæ–¹æ¡ˆæ—¶æ˜¾ç¤ºæ–¹æ¡ˆåç§°
                if (activePlans.length > 1) {
                    message += `${plan.name}ï¼š\n`;
                }
                
                const segments = plan.segments;
                const luggagePlans = plan.luggagePlans;
                const segmentsInfo = []; // å­˜å‚¨æ‰€æœ‰èˆªæ®µä¿¡æ¯ï¼Œç”¨äºåˆ¤æ–­å¾€è¿”
                
                // å…ˆæ”¶é›†æ‰€æœ‰èˆªæ®µä¿¡æ¯
                segments.forEach((segment) => {
                    const id = segment.id;
                    const from = document.getElementById(`${id}-from`).value;
                    const to = document.getElementById(`${id}-to`).value;
                    segmentsInfo.push({ from, to });
                });
                
                // åˆ¤æ–­æ˜¯å¦ä¸ºå¾€è¿”è¡Œç¨‹ï¼ˆç¬¬ä¸€æ®µèµ·é£åŸå¸‚ = æœ€åä¸€æ®µåˆ°è¾¾åŸå¸‚ï¼‰
                const isRoundTrip = segmentsInfo.length > 1 && 
                                   segmentsInfo[0].from === segmentsInfo[segmentsInfo.length - 1].to;
                
                // ç¡®å®šå¾€è¿”åˆ†å‰²ç‚¹ï¼ˆå»ç¨‹æœ€åä¸€æ®µçš„ç´¢å¼•ï¼‰
                let returnSegmentStartIndex = -1;
                if (isRoundTrip) {
                    // æ‰¾åˆ°è¿”ç¨‹å¼€å§‹çš„ä½ç½®ï¼ˆä»å‰å¾€åæ‰¾ç¬¬ä¸€ä¸ªå›åˆ°èµ·ç‚¹åŸå¸‚çš„æ®µï¼‰
                    for (let i = 1; i < segmentsInfo.length; i++) {
                        if (segmentsInfo[i].to === segmentsInfo[0].from) {
                            returnSegmentStartIndex = i;
                            break;
                        }
                    }
                    // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œé»˜è®¤æœ€åä¸€æ®µæ˜¯è¿”ç¨‹ç¬¬ä¸€æ®µ
                    if (returnSegmentStartIndex === -1) {
                        returnSegmentStartIndex = segmentsInfo.length - 1;
                    }
                }
                
                // å¤„ç†èˆªç­æ®µ
                segments.forEach((segment, index) => {
                    // è·å–å½“å‰èˆªæ®µID
                    const segmentId = segment.dataset.segmentId;
                    const id = segment.id;
                    const date = document.getElementById(`${id}-date`).value;
                    const from = document.getElementById(`${id}-from`).value;
                    const departureTimeInput = document.getElementById(`${id}-departureTime`).value;
                    const arrivalTimeInput = document.getElementById(`${id}-arrivalTime`).value;
                    const to = document.getElementById(`${id}-to`).value;
                    
                    // ä¿®å¤ï¼šä½¿ç”¨ç±»é€‰æ‹©å™¨å’Œèˆªæ®µIDè·å–æ­£ç¡®çš„æŒ‰é’®çŠ¶æ€
                    const isMidnightActive = segment.querySelector('.toggle-btn-midnight').classList.contains('active');
                    const isNextDay1Active = segment.querySelector('.toggle-btn-next-day-1').classList.contains('active');
                    const isNextDayActive = segment.querySelector('.toggle-btn-next-day').classList.contains('active');
                    
                    // å¤„ç†èµ·é£æ—¶é—´
                    const departureDisplay = processDepartureTime(
                        date, 
                        departureTimeInput, 
                        isMidnightActive,
                        isNextDayActive
                    );
                    
                    // å¤„ç†æŠµè¾¾æ—¶é—´
                    const arrivalDisplay = processArrivalTime(arrivalTimeInput, isNextDay1Active);
                    
                    // æ‹¼æ¥èˆªæ®µä¿¡æ¯
                    let segmentText = '';
                    
                    // ç¬¬ä¸€æ®µæˆ–æ–°æ–¹æ¡ˆçš„ç¬¬ä¸€æ®µæ˜¾ç¤ºå®Œæ•´æ—¥æœŸ
                    if (index === 0) {
                        segmentText += `${date}${from}${departureDisplay}é£ï¼Œ${arrivalDisplay}åˆ°è¾¾${to}`;
                        
                        // å¦‚æœä¸æ˜¯æœ€åä¸€æ®µï¼Œæ·»åŠ é€—å·
                        if (segments.length > 1) {
                            segmentText += 'ï¼Œ';
                        }
                    } 
                    // å¾€è¿”è¡Œç¨‹çš„è¿”ç¨‹ç¬¬ä¸€æ®µ
                    else if (isRoundTrip && index === returnSegmentStartIndex) {
                        segmentText += `\nè¿”ç¨‹ä¿¡æ¯ï¼š${getNextDepartureDateDisplay(date)}${from}${departureDisplay}é£ï¼Œ${arrivalDisplay}åˆ°è¾¾${to}`;
                        
                        // å¦‚æœä¸æ˜¯æœ€åä¸€æ®µï¼Œæ·»åŠ é€—å·
                        if (index !== segments.length - 1) {
                            segmentText += 'ï¼Œ';
                        }
                    }
                    // åç»­æ®µç”¨"å†"è¿æ¥
                    else {
                        const dateDisplay = getNextDepartureDateDisplay(date);
                        segmentText += `å†${dateDisplay}${from}${departureDisplay}é£ï¼Œ${arrivalDisplay}åˆ°è¾¾${to}`;
                        
                        // ä¸æ˜¯æœ€åä¸€æ®µå°±åŠ é€—å·
                        if (index !== segments.length - 1) {
                            segmentText += 'ï¼Œ';
                        }
                    }
                    
                    message += segmentText;
                });
                
                // æ·»åŠ æ‰˜è¿ä¿¡æ¯
                if (luggagePlans.length > 0) {
                    message += 'ï¼Œ';
                    luggagePlans.forEach((luggagePlan, lpIndex) => {
                        const id = luggagePlan.id;
                        const luggageType = document.getElementById(`${id}-luggage`).value;
                        const price = document.getElementById(`${id}-price`).value;
                        const handLuggage = document.getElementById(`handLuggage${id.replace('plan', '')}`).value;
                        const notes = document.getElementById(`selectedNotes${id.replace('plan', '')}`).value;
                        
                        if (luggageType && luggageType !== 'æ— ') {
                            message += `${luggageType}${price ? price : ''}`;
                            if (lpIndex !== luggagePlans.length - 1) {
                                message += 'ï¼Œ';
                            }
                        }
                        
                        if (handLuggage) {
                            message += `ï¼Œ${handLuggage}`;
                        }
                        
                        if (notes) {
                            message += `ï¼Œ${notes}`;
                        }
                    });
                }
                
                // æ–¹æ¡ˆä¹‹é—´åŠ æ¢è¡Œ
                if (planIndex !== activePlans.length - 1) {
                    message += '\n';
                }
            });
            
            // æ·»åŠ æ¸©é¦¨æç¤º
            message += `\n\nğŸ””æ¸©é¦¨æç¤ºï¼š\næœºç¥¨ä»·æ ¼éšé”€å”®å®æ—¶å˜åŠ¨ï¼Œæ—©ç‚¹æ•²å®šè¡Œç¨‹ï¼Œèƒ½å¸®æ‚¨æ›´å¿«å‡ºç¥¨å“¦ï½\nâœˆï¸é•¿åŸç¥¨åŠ¡âœˆï¸`;
            
            // æ˜¾ç¤ºç»“æœ
            document.getElementById('output').textContent = message;
        }
        
        function resetForm() {
            // æ¸…ç©ºæ‰€æœ‰èˆªç­æ®µ
            document.getElementById('flightSegmentsAbove').innerHTML = '';
            document.getElementById('flightSegmentsMiddle').innerHTML = '';
            document.getElementById('flightSegmentsBelow').innerHTML = '';
            
            // æ¸…ç©ºæ‰€æœ‰æ‰˜è¿æ–¹æ¡ˆ
            document.getElementById('luggagePlansAbove').innerHTML = '';
            document.getElementById('luggagePlansMiddle').innerHTML = '';
            document.getElementById('luggagePlansBelow').innerHTML = '';
            
            // é‡ç½®è®¡æ•°å™¨
            segmentCount = 0;
            planCount = 0;
            
            // æ¸…ç©ºè¾“å‡º
            document.getElementById('output').textContent = '';
        }
        
        function copyToClipboard() {
            const output = document.getElementById('output').textContent;
            navigator.clipboard.writeText(output).then(() => {
                alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚');
                console.error('å¤åˆ¶å¤±è´¥:', err);
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶æ·»åŠ ä¸€ä¸ªåˆå§‹èˆªæ®µ
        window.onload = function() {
            addFlightSegment('above');
        };
    </script>
</body>
</html>
