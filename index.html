<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电商合作账簿系统</title>
    <!-- 引入SheetJS库用于Excel导出 -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0078d7;
            --secondary-color: #f3f2f1;
            --border-color: #d2d0ce;
            --text-color: #323130;
            --hover-color: #deecf9;
            --header-height: 44px;
            --footer-height: 50px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-color);
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: 932px;
            background-color: white;
        }
        
        /* 头部导航 */
        .header {
            height: var(--header-height);
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header h1 {
            font-size: 18px;
            font-weight: 600;
        }
        
        /* 内容区域 */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        /* 底部导航 - 优化 */
        .footer {
            height: var(--footer-height);
            background-color: var(--secondary-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid var(--border-color);
            padding: 0 5px;
            /* 上移10px */
            margin-bottom: 10px;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: var(--text-color);
            cursor: pointer;
            padding: 3px 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
            height: 100%;
            flex: 1;
            max-width: 60px;
        }
        
        .nav-item.active {
            color: var(--primary-color);
            background-color: var(--hover-color);
        }
        
        .nav-item i {
            font-size: 16px;
            margin-bottom: 2px;
        }
        
        /* Windows对话框风格卡片 */
        .card {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .card-header {
            background-color: var(--secondary-color);
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }
        
        .card-body {
            padding: 12px;
        }
        
        /* 表单样式 */
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .form-col {
            flex: 1;
            margin-right: 10px;
        }
        
        .form-col:last-child {
            margin-right: 0;
        }
        
        label {
            display: block;
            margin-bottom: 4px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .required::after {
            content: " *";
            color: red;
        }
        
        input, select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            font-size: 14px;
            background-color: white;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .display-box {
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            background-color: var(--secondary-color);
            font-size: 14px;
            text-align: left;
        }
        
        /* 按钮样式 */
        .btn {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background-color: #106ebe;
        }
        
        .btn-danger {
            background-color: #d13438;
        }
        
        .btn-danger:hover {
            background-color: #b02a30;
        }
        
        .btn-success {
            background-color: #38a169;
        }
        
        .btn-success:hover {
            background-color: #2f855a;
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        /* 表格样式 - 优化为紧凑型 */
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
            width: 100%;
        }
        
        table {
            width: auto; /* 改为auto以支持横向扩展 */
            min-width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            table-layout: auto; /* 改为auto以支持自定义列宽 */
        }
        
        th, td {
            border: 1px solid var(--border-color);
            padding: 4px 6px;
            text-align: left;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            height: 25px; /* 设置固定行高 */
        }
        
        /* 固定列宽 */
        .date-cell {
            width: 40px;
            min-width: 40px;
        }
        
        .product-name-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .code-cell {
            width: 40px;
            min-width: 40px;
        }
        
        .quantity-cell {
            width: 40px;
            min-width: 40px;
        }
        
        .weight-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .volume-cell {
            width: 60px;
            min-width: 60px;
        }
        
        .fee-cell {
            width: 40px;
            min-width: 40px;
        }
        
        .currency-cell {
            width: 40px;
            min-width: 40px;
        }
        
        .exchange-rate-cell {
            width: 40px;
            min-width: 40px;
        }
        
        .ruble-equivalent-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .pallet-fee-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .cube-fee-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .delivery-fee-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .total-cell {
            width: 80px;
            min-width: 80px;
        }
        
        .settlement-cell {
            width: 80px;
            min-width: 80px;
        }
        
        .notes-cell {
            width: 100px;
            min-width: 100px;
        }
        
        .unit-cell {
            width: 40px;
            min-width: 40px;
        }
        
        .unit-price-cell {
            width: 50px;
            min-width: 50px;
        }
        
        .cny-amount-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .ruble-amount-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .description-cell {
            width: 100px;
            min-width: 100px;
        }
        
        .income-expense-type-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .income-expense-form-cell {
            width: 70px;
            min-width: 70px;
        }
        
        .recipient-cell {
            width: 60px;
            min-width: 60px;
        }
        
        .account-cell {
            width: 40px;
            min-width: 40px;
        }
        
        .payment-method-cell {
            width: 70px;
            min-width: 70px;
        }
        
        th {
            background-color: var(--secondary-color);
            font-weight: 600;
            position: relative;
        }
        
        .filter-icon {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        
        /* 页面隐藏/显示 */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* 设置页样式 */
        .settings-section {
            margin-bottom: 20px;
        }
        
        .settings-section h3 {
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--primary-color);
        }
        
        textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }
        
        /* 下拉列表样式 */
        .dropdown {
            position: relative;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 100%;
            border: 1px solid var(--border-color);
            border-top: none;
            z-index: 1;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .dropdown-content div {
            padding: 8px 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .dropdown-content div:hover {
            background-color: var(--hover-color);
        }
        
        .dropdown.active .dropdown-content {
            display: block;
        }
        
        /* 币种选择样式 */
        .currency-select {
            width: auto;
            min-width: 80px;
        }
        
        /* 隐藏元素 */
        .hidden {
            display: none;
        }
        
        /* 付款状态管理系统样式 */
        .payment-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .filter-status {
            margin-bottom: 10px;
            padding: 8px;
            background-color: #ebf8ff;
            border-radius: 4px;
            border: 1px solid #bee3f8;
            font-size: 12px;
        }
        
        .filter-tag {
            display: inline-block;
            background-color: #3182ce;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            margin-right: 5px;
            font-size: 11px;
        }
        
        .clear-filter {
            color: #e53e3e;
            cursor: pointer;
            margin-left: 10px;
            font-weight: bold;
        }
        
        .payment-table-container {
            overflow-x: auto;
            width: 100%;
        }
        
        .payment-table {
            width: auto; /* 改为auto以支持横向扩展 */
            min-width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 11px;
            table-layout: auto; /* 改为auto以支持自定义列宽 */
        }
        
        .payment-table th,
        .payment-table td {
            border: 1px solid #e2e8f0;
            padding: 4px 6px;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            height: 25px; /* 设置固定行高 */
        }
        
        .payment-table th {
            background-color: #f7fafc;
            font-weight: 600;
            position: relative;
        }
        
        .payment-table th .filter-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 12px;
            color: #000;
        }
        
        .payment-table tr:nth-child(even) {
            background-color: #f7fafc;
        }
        
        .payment-table tr:hover {
            background-color: #ebf8ff;
        }
        
        .payment-table .select-all {
            width: 25px;
            min-width: 25px;
            padding: 4px;
        }
        
        .payment-table .select-row {
            width: 25px;
            min-width: 25px;
            text-align: center;
            padding: 4px;
        }
        
        /* 筛选下拉框样式 - 优化复选框间距 */
        .filter-dropdown {
            position: absolute;
            background-color: white;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            padding: 5px;
            min-width: 150px;
            font-size: 12px;
            text-align: left; /* 筛选内容靠左对齐 */
        }
        
        .filter-item {
            padding: 3px 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: flex-start; /* 内容靠左对齐 */
            text-align: left;
        }
        
        .filter-item:hover {
            background-color: #ebf8ff;
        }
        
        .filter-checkbox {
            margin-right: 5px;
            transform: scale(0.9);
        }
        
        /* 付款表格总计行样式 */
        .payment-total-row {
            background-color: #e6fffa !important;
            font-weight: bold;
        }

        .payment-total-row td {
            border-top: 2px solid #319795 !important;
        }
        
        /* 设置所有显示的文字方向为横向，除了表格内的描述列和备注列以外，其他所有显示的文字不自动换行 */
        * {
            white-space: nowrap;
        }
        
        .description-cell, .notes-cell {
            white-space: normal !important;
        }
        
        /* 消息提示 */
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }
        
        .message.success {
            background-color: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        
        .message.error {
            background-color: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }
        
        /* 确认对话框样式 */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .confirm-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 300px;
            width: 80%;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .confirm-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .confirm-btn.yes {
            background-color: #0078d7;
            color: white;
        }
        
        .confirm-btn.no {
            background-color: #f3f2f1;
            color: #323130;
        }
        
        /* 结算状态下拉选择样式 - 默认设置为未结算 */
        .settlement-select {
            width: 100%;
            padding: 4px;
            border: 1px solid #d2d0ce;
            border-radius: 2px;
            background-color: white;
            font-size: 11px;
        }
        
        /* 可编辑备注样式 */
        .editable-notes {
            width: 100%;
            padding: 4px;
            border: 1px solid #d2d0ce;
            border-radius: 2px;
            background-color: white;
            font-size: 11px;
            resize: vertical;
            min-height: 40px;
            line-height: 20px; /* 设置行高为20px */
            height: 20px; /* 设置固定高度 */
        }
        
        /* 多选筛选样式 */
        .filter-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid #e2e8f0;
        }
        
        .filter-apply-btn {
            background-color: #0078d7;
            color: white;
            border: none;
            border-radius: 2px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .filter-clear-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 2px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 11px;
        }
        
        /* 导出按钮样式 */
        .export-btn {
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 2px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .export-btn:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>电商合作账簿系统</h1>
        </div>
        
        <div class="content">
            <!-- 概览页面 -->
            <div id="overview-page" class="page active">
                <div class="card">
                    <div class="card-header">账户概览</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label>OZON账户余额(₽)</label>
                                <div id="ozon-balance" class="display-box">0</div>
                            </div>
                            <div class="form-col">
                                <label>WB账户余额(₽)</label>
                                <div id="wb-balance" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>个体账户余额(₽)</label>
                                <div id="individual-balance" class="display-box">0</div>
                            </div>
                            <div class="form-col">
                                <label>现金余额(₽)</label>
                                <div id="cash-balance" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>总金额(₽)</label>
                                <div id="total-balance" class="display-box">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 商品清单页面 -->
            <div id="products-page" class="page">
                <div class="card">
                    <div class="card-header">商品清单</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">到货日期</label>
                                <input type="text" id="arrival-date" placeholder="YYYYMMDD" maxlength="8">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">商品名称</label>
                                <div class="dropdown">
                                    <input type="text" id="product-name" placeholder="输入商品名称">
                                    <div class="dropdown-content" id="product-name-dropdown"></div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label>颜色</label>
                                <select id="color-select">
                                    <option value="">选择颜色</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">数量</label>
                                <input type="text" id="quantity" placeholder="输入数量">
                            </div>
                            <div class="form-col">
                                <label>单位</label>
                                <select id="unit-select">
                                    <option value="件" selected>件</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">单价(¥)</label>
                                <input type="text" id="unit-price" placeholder="输入单价">
                            </div>
                            <div class="form-col">
                                <label class="required">汇率</label>
                                <input type="text" id="exchange-rate" placeholder="输入汇率">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>折合卢布</label>
                                <div id="ruble-price" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>金额(¥)</label>
                                <div id="cny-amount" class="display-box">0</div>
                            </div>
                            <div class="form-col">
                                <label>金额(₽)</label>
                                <div id="ruble-amount" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>描述</label>
                                <input type="text" id="product-description" placeholder="输入描述">
                            </div>
                        </div>
                        
                        <!-- 导出按钮 -->
                        <button id="exportProductsBtn" class="export-btn">生成表格</button>
                        
                        <!-- 付款状态管理系统表格 -->
                        <div class="payment-actions">
                            <button id="addPaymentBtnProducts" class="btn btn-success">添加记录</button>
                            <button id="clearFilterBtnProducts" class="btn btn-secondary">取消筛选</button>
                            <button id="deletePaymentBtnProducts" class="btn btn-danger">删除选中</button>
                        </div>
                        
                        <!-- 筛选状态显示 -->
                        <div class="filter-status" id="filterStatusProducts" style="display: none;">
                            当前筛选条件: <span id="filterTagsProducts"></span>
                            <span class="clear-filter" id="clearFilterProducts">清除筛选</span>
                        </div>
                        
                        <div class="payment-table-container">
                            <table class="payment-table">
                                <thead>
                                    <tr>
                                        <th class="select-all">
                                            <input type="checkbox" id="selectAllPaymentsProducts">
                                        </th>
                                        <th class="date-cell">
                                            日期
                                            <button class="filter-btn" data-column="date">▼</button>
                                        </th>
                                        <th class="product-name-cell">
                                            商品名称
                                            <button class="filter-btn" data-column="productName">▼</button>
                                        </th>
                                        <th class="notes-cell">
                                            颜色
                                            <button class="filter-btn" data-column="color">▼</button>
                                        </th>
                                        <th class="quantity-cell">
                                            数量
                                            <button class="filter-btn" data-column="quantity">▼</button>
                                        </th>
                                        <th class="unit-cell">
                                            单位
                                            <button class="filter-btn" data-column="unit">▼</button>
                                        </th>
                                        <th class="unit-price-cell">
                                            单价(¥)
                                            <button class="filter-btn" data-column="unitPrice">▼</button>
                                        </th>
                                        <th class="exchange-rate-cell">
                                            汇率
                                            <button class="filter-btn" data-column="exchangeRate">▼</button>
                                        </th>
                                        <th class="ruble-equivalent-cell">
                                            折合卢布
                                            <button class="filter-btn" data-column="rublePrice">▼</button>
                                        </th>
                                        <th class="cny-amount-cell">
                                            金额(¥)
                                            <button class="filter-btn" data-column="cnyAmount">▼</button>
                                        </th>
                                        <th class="ruble-amount-cell">
                                            金额(₽)
                                            <button class="filter-btn" data-column="rubleAmount">▼</button>
                                        </th>
                                        <th class="description-cell">
                                            描述
                                            <button class="filter-btn" data-column="description">▼</button>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="paymentTableBodyProducts">
                                    <!-- 付款记录将通过JavaScript动态添加 -->
                                </tbody>
                                <tfoot>
                                    <tr class="payment-total-row" id="totalRowProducts">
                                        <td colspan="10" style="text-align: right;">总计:</td>
                                        <td id="totalAmountProducts">0</td>
                                        <td></td>
                                    </tr>
                                    <tr class="payment-total-row" id="filteredTotalRowProducts" style="display: none;">
                                        <td colspan="10" style="text-align: right;">筛选结果总计:</td>
                                        <td id="filteredTotalAmountProducts">0</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 运费支出页面 -->
            <div id="shipping-page" class="page">
                <div class="card">
                    <div class="card-header">运费支出</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">日期</label>
                                <input type="text" id="shipping-date" placeholder="YYYYMMDD" maxlength="8">
                            </div>
                            <div class="form-col">
                                <label>货号</label>
                                <input type="text" id="shipping-code" placeholder="输入货号">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">商品名称</label>
                                <div class="dropdown">
                                    <input type="text" id="shipping-product" placeholder="输入商品名称">
                                    <div class="dropdown-content" id="shipping-product-dropdown"></div>
                                </div>
                            </div>
                            <div class="form-col">
                                <label class="required">重量(Kg)</label>
                                <input type="text" id="shipping-weight" placeholder="输入重量">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>体积m³</label>
                                <input type="text" id="shipping-volume" placeholder="输入体积">
                            </div>
                            <div class="form-col">
                                <label>件数</label>
                                <input type="text" id="shipping-quantity" placeholder="输入件数">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">运费</label>
                                <input type="text" id="shipping-fee" placeholder="输入运费">
                            </div>
                            <div class="form-col">
                                <label class="required">币种</label>
                                <select id="shipping-currency" class="currency-select">
                                    <option value="">选择币种</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">汇率</label>
                                <input type="text" id="shipping-exchange-rate" placeholder="输入汇率">
                            </div>
                            <div class="form-col">
                                <label>折合卢布</label>
                                <div id="shipping-ruble" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>托盘费(₽)</label>
                                <input type="text" id="pallet-fee" placeholder="输入托盘费">
                            </div>
                            <div class="form-col">
                                <label>立方费(₽)</label>
                                <input type="text" id="cube-fee" placeholder="输入立方费">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>送货车费(₽)</label>
                                <input type="text" id="delivery-fee" placeholder="输入送货车费">
                            </div>
                            <div class="form-col">
                                <label>运费总计(₽)</label>
                                <div id="shipping-total" class="display-box">0</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>备注</label>
                                <input type="text" id="shipping-notes" placeholder="输入备注">
                            </div>
                        </div>
                        
                        <!-- 导出按钮 -->
                        <button id="exportShippingBtn" class="export-btn">生成表格</button>
                        
                        <!-- 付款状态管理系统表格 -->
                        <div class="payment-actions">
                            <button id="addPaymentBtnShipping" class="btn btn-success">添加记录</button>
                            <button id="clearFilterBtnShipping" class="btn btn-secondary">取消筛选</button>
                            <button id="deletePaymentBtnShipping" class="btn btn-danger">删除选中</button>
                        </div>
                        
                        <!-- 筛选状态显示 -->
                        <div class="filter-status" id="filterStatusShipping" style="display: none;">
                            当前筛选条件: <span id="filterTagsShipping"></span>
                            <span class="clear-filter" id="clearFilterShipping">清除筛选</span>
                        </div>
                        
                        <div class="payment-table-container">
                            <table class="payment-table">
                                <thead>
                                    <tr>
                                        <th class="select-all">
                                            <input type="checkbox" id="selectAllPaymentsShipping">
                                        </th>
                                        <th class="date-cell">
                                            日期
                                            <button class="filter-btn" data-column="date">▼</button>
                                        </th>
                                        <th class="product-name-cell">
                                            商品名称
                                            <button class="filter-btn" data-column="product">▼</button>
                                        </th>
                                        <th class="code-cell">
                                            货号
                                            <button class="filter-btn" data-column="code">▼</button>
                                        </th>
                                        <th class="quantity-cell">
                                            件数
                                            <button class="filter-btn" data-column="quantity">▼</button>
                                        </th>
                                        <th class="weight-cell">
                                            重量(Kg)
                                            <button class="filter-btn" data-column="weight">▼</button>
                                        </th>
                                        <th class="volume-cell">
                                            体积m³
                                            <button class="filter-btn" data-column="volume">▼</button>
                                        </th>
                                        <th class="fee-cell">
                                            运费
                                            <button class="filter-btn" data-column="fee">▼</button>
                                        </th>
                                        <th class="currency-cell">
                                            币种
                                            <button class="filter-btn" data-column="currency">▼</button>
                                        </th>
                                        <th class="exchange-rate-cell">
                                            汇率
                                            <button class="filter-btn" data-column="exchangeRate">▼</button>
                                        </th>
                                        <th class="ruble-equivalent-cell">
                                            折合卢布
                                            <button class="filter-btn" data-column="rubleEquivalent">▼</button>
                                        </th>
                                        <th class="pallet-fee-cell">
                                            托盘费(₽)
                                            <button class="filter-btn" data-column="palletFee">▼</button>
                                        </th>
                                        <th class="cube-fee-cell">
                                            立方费(₽)
                                            <button class="filter-btn" data-column="cubeFee">▼</button>
                                        </th>
                                        <th class="delivery-fee-cell">
                                            送货车费(₽)
                                            <button class="filter-btn" data-column="deliveryFee">▼</button>
                                        </th>
                                        <th class="total-cell">
                                            运费总计(₽)
                                            <button class="filter-btn" data-column="total">▼</button>
                                        </th>
                                        <th class="settlement-cell">
                                            结算
                                            <button class="filter-btn" data-column="settlement">▼</button>
                                        </th>
                                        <th class="notes-cell">
                                            备注
                                            <button class="filter-btn" data-column="notes">▼</button>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="paymentTableBodyShipping">
                                    <!-- 付款记录将通过JavaScript动态添加 -->
                                </tbody>
                                <tfoot>
                                    <tr class="payment-total-row" id="totalRowShipping">
                                        <td colspan="15" style="text-align: right;">总计:</td>
                                        <td id="totalAmountShipping">0</td>
                                        <td></td>
                                    </tr>
                                    <tr class="payment-total-row" id="filteredTotalRowShipping" style="display: none;">
                                        <td colspan="15" style="text-align: right;">筛选结果总计:</td>
                                        <td id="filteredTotalAmountShipping">0</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 收支记录页面 -->
            <div id="records-page" class="page">
                <div class="card">
                    <div class="card-header">收支记录</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">日期</label>
                                <input type="text" id="record-date" placeholder="YYYYMMDD" maxlength="8">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">收支类型</label>
                                <select id="record-type">
                                    <option value="">选择收支类型</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <label class="required">收支形式</label>
                                <select id="record-form">
                                    <option value="">选择收支形式</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">金额(₽)</label>
                                <input type="text" id="record-amount" placeholder="输入金额">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">描述</label>
                                <input type="text" id="record-description" placeholder="输入描述">
                            </div>
                        </div>
                        
                        <!-- 导出按钮 -->
                        <button id="exportRecordsBtn" class="export-btn">生成表格</button>
                        
                        <!-- 消息提示 -->
                        <div id="message" class="message" style="display: none;"></div>
                        
                        <!-- 付款状态管理系统表格 -->
                        <div class="payment-actions">
                            <button id="addPaymentBtn" class="btn btn-success">添加记录</button>
                            <button id="clearFilterBtn" class="btn btn-secondary">取消筛选</button>
                            <button id="deletePaymentBtn" class="btn btn-danger">删除选中</button>
                        </div>
                        
                        <!-- 筛选状态显示 -->
                        <div class="filter-status" id="filterStatus" style="display: none;">
                            当前筛选条件: <span id="filterTags"></span>
                            <span class="clear-filter" id="clearFilter">清除筛选</span>
                        </div>
                        
                        <div class="payment-table-container">
                            <table class="payment-table">
                                <thead>
                                    <tr>
                                        <th class="select-all">
                                            <input type="checkbox" id="selectAllPayments">
                                        </th>
                                        <th class="date-cell">
                                            日期
                                            <button class="filter-btn" data-column="date">▼</button>
                                        </th>
                                        <th class="income-expense-type-cell">
                                            收支类型
                                            <button class="filter-btn" data-column="type">▼</button>
                                        </th>
                                        <th class="cny-amount-cell">
                                            金额(₽)
                                            <button class="filter-btn" data-column="amount">▼</button>
                                        </th>
                                        <th class="income-expense-form-cell">
                                            收支形式
                                            <button class="filter-btn" data-column="form">▼</button>
                                        </th>
                                        <th class="settlement-cell">
                                            结算
                                            <button class="filter-btn" data-column="settlement">▼</button>
                                        </th>
                                        <th class="description-cell">
                                            描述
                                            <button class="filter-btn" data-column="description">▼</button>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="paymentTableBody">
                                    <!-- 付款记录将通过JavaScript动态添加 -->
                                </tbody>
                                <tfoot>
                                    <tr class="payment-total-row" id="totalRow">
                                        <td colspan="3" style="text-align: right;">总计:</td>
                                        <td id="totalAmount">0</td>
                                        <td colspan="3"></td>
                                    </tr>
                                    <tr class="payment-total-row" id="filteredTotalRow" style="display: none;">
                                        <td colspan="3" style="text-align: right;">筛选结果总计:</td>
                                        <td id="filteredTotalAmount">0</td>
                                        <td colspan="3"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 货款支付页面 -->
            <div id="payment-page" class="page">
                <div class="card">
                    <div class="card-header">货款支付</div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">日期</label>
                                <input type="text" id="payment-date" placeholder="YYYYMMDD" maxlength="8">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">收款人</label>
                                <div class="dropdown">
                                    <input type="text" id="payment-recipient" placeholder="输入收款人">
                                    <div class="dropdown-content" id="recipient-dropdown"></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">账号</label>
                                <input type="text" id="payment-account" placeholder="输入账号" pattern="[0-9]*">
                            </div>
                            <div class="form-col">
                                <label class="required">支付方式</label>
                                <select id="payment-method">
                                    <option value="">选择支付方式</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">金额(¥)</label>
                                <input type="text" id="payment-amount" placeholder="输入金额">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>备注</label>
                                <input type="text" id="payment-notes" placeholder="输入备注">
                            </div>
                        </div>
                        
                        <!-- 导出按钮 -->
                        <button id="exportPaymentBtn" class="export-btn">生成表格</button>
                        
                        <!-- 付款状态管理系统表格 -->
                        <div class="payment-actions">
                            <button id="addPaymentBtnPayment" class="btn btn-success">添加记录</button>
                            <button id="clearFilterBtnPayment" class="btn btn-secondary">取消筛选</button>
                            <button id="deletePaymentBtnPayment" class="btn btn-danger">删除选中</button>
                        </div>
                        
                        <!-- 筛选状态显示 -->
                        <div class="filter-status" id="filterStatusPayment" style="display: none;">
                            当前筛选条件: <span id="filterTagsPayment"></span>
                            <span class="clear-filter" id="clearFilterPayment">清除筛选</span>
                        </div>
                        
                        <div class="payment-table-container">
                            <table class="payment-table">
                                <thead>
                                    <tr>
                                        <th class="select-all">
                                            <input type="checkbox" id="selectAllPaymentsPayment">
                                        </th>
                                        <th class="date-cell">
                                            日期
                                            <button class="filter-btn" data-column="date">▼</button>
                                        </th>
                                        <th class="recipient-cell">
                                            收款人
                                            <button class="filter-btn" data-column="recipient">▼</button>
                                        </th>
                                        <th class="account-cell">
                                            账号
                                            <button class="filter-btn" data-column="account">▼</button>
                                        </th>
                                        <th class="payment-method-cell">
                                            支付方式
                                            <button class="filter-btn" data-column="method">▼</button>
                                        </th>
                                        <th class="cny-amount-cell">
                                            金额(¥)
                                            <button class="filter-btn" data-column="amount">▼</button>
                                        </th>
                                        <th class="settlement-cell">
                                            结算
                                            <button class="filter-btn" data-column="settlement">▼</button>
                                        </th>
                                        <th class="notes-cell">
                                            备注
                                            <button class="filter-btn" data-column="notes">▼</button>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="paymentTableBodyPayment">
                                    <!-- 付款记录将通过JavaScript动态添加 -->
                                </tbody>
                                <tfoot>
                                    <tr class="payment-total-row" id="totalRowPayment">
                                        <td colspan="5" style="text-align: right;">总计:</td>
                                        <td id="totalAmountPayment">0</td>
                                        <td colspan="2"></td>
                                    </tr>
                                    <tr class="payment-total-row" id="filteredTotalRowPayment" style="display: none;">
                                        <td colspan="5" style="text-align: right;">筛选结果总计:</td>
                                        <td id="filteredTotalAmountPayment">0</td>
                                        <td colspan="2"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 设置页面 -->
            <div id="settings-page" class="page">
                <div class="card">
                    <div class="card-header">系统设置</div>
                    <div class="card-body">
                        <!-- 导出总表按钮 -->
                        <button id="exportAllDataBtn" class="export-btn">生成总表</button>
                        
                        <!-- 账户余额设置 -->
                        <div class="settings-section">
                            <h3>账户余额设置</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>OZON账户余额(₽)</label>
                                    <input type="text" id="ozon-input" placeholder="输入金额">
                                </div>
                                <div class="form-col">
                                    <label>WB账户余额(₽)</label>
                                    <input type="text" id="wb-input" placeholder="输入金额">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>个体账户余额(₽)</label>
                                    <input type="text" id="individual-input" placeholder="输入金额">
                                </div>
                                <div class="form-col">
                                    <label>现金余额(₽)</label>
                                    <div id="cash-display" class="display-box">0</div>
                                </div>
                            </div>
                            <button class="btn" id="update-balance">更新金额</button>
                        </div>
                        
                        <div class="settings-section">
                            <h3>商品清单</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>商品名称列表(每行一个)</label>
                                    <textarea id="product-names-list"></textarea>
                                </div>
                                <div class="form-col">
                                    <label>颜色列表(每行一个)</label>
                                    <textarea id="colors-list"></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>单位列表(每行一个)</label>
                                    <textarea id="units-list"></textarea>
                                </div>
                                <div class="form-col">
                                    <!-- 空白区域 -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>收支记录</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>收支类型(每行一个)</label>
                                    <textarea id="income-expense-types"></textarea>
                                </div>
                                <div class="form-col">
                                    <label>收支形式(每行一个)</label>
                                    <textarea id="income-expense-forms"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>运费支出</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>币种列表(每行一个)</label>
                                    <textarea id="currency-list"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>货款支付</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>收款人-账号对应关系 (每行一个，格式：收款人,账号)</label>
                                    <textarea id="payment-relations"></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>支付方式列表(每行一个)</label>
                                    <textarea id="payment-methods-list"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <button class="btn" id="save-settings">保存设置</button>
                            </div>
                            <div class="form-col">
                                <button class="btn btn-danger" id="delete-all-data">删除所有数据</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div class="nav-item active" data-page="overview-page">
                <i>📊</i>
                <span>概览</span>
            </div>
            <div class="nav-item" data-page="products-page">
                <i>📦</i>
                <span>商品清单</span>
            </div>
            <div class="nav-item" data-page="shipping-page">
                <i>🚚</i>
                <span>运费支出</span>
            </div>
            <div class="nav-item" data-page="records-page">
                <i>📝</i>
                <span>收支记录</span>
            </div>
            <div class="nav-item" data-page="payment-page">
                <i>💳</i>
                <span>货款支付</span>
            </div>
            <div class="nav-item" data-page="settings-page">
                <i>⚙️</i>
                <span>设置</span>
            </div>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div id="confirmDialog" class="confirm-dialog" style="display: none;">
        <div class="confirm-content">
            <div id="confirmMessage"></div>
            <div class="confirm-buttons">
                <button id="confirmYes" class="confirm-btn yes">是</button>
                <button id="confirmNo" class="confirm-btn no">否</button>
            </div>
        </div>
    </div>

    <script>
        // 页面切换功能
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // 移除所有活动状态
                document.querySelectorAll('.nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                // 添加当前活动状态
                this.classList.add('active');
                const pageId = this.getAttribute('data-page');
                document.getElementById(pageId).classList.add('active');
                
                // 更新页面数据
                if (pageId === 'overview-page') {
                    updateOverview();
                } else if (pageId === 'records-page') {
                    renderPaymentTable();
                } else if (pageId === 'shipping-page') {
                    renderPaymentTableShipping();
                } else if (pageId === 'products-page') {
                    renderPaymentTableProducts();
                } else if (pageId === 'payment-page') {
                    renderPaymentTablePayment();
                }
            });
        });
        
        // 格式化数字为千分位
        function formatNumber(num) {
            if (!num || isNaN(num)) return '0';
            return parseFloat(num).toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
        }
        
        // 移除千分位格式
        function unformatNumber(str) {
            if (!str) return 0;
            return parseFloat(str.replace(/,/g, '')) || 0;
        }
        
        // 日期格式化
        function formatDate(dateStr) {
            if (dateStr.length === 8) {
                return dateStr.substring(0, 4) + '/' + dateStr.substring(4, 6) + '/' + dateStr.substring(6, 8);
            }
            return dateStr;
        }
        
        // 显示消息
        function showMessage(message, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = message;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            
            // 3秒后自动隐藏
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }
        
        // 自定义确认对话框
        function showConfirm(message, callback) {
            const dialog = document.getElementById('confirmDialog');
            const messageEl = document.getElementById('confirmMessage');
            const yesBtn = document.getElementById('confirmYes');
            const noBtn = document.getElementById('confirmNo');
            
            messageEl.textContent = message;
            dialog.style.display = 'flex';
            
            // 移除之前的事件监听器
            const newYesBtn = yesBtn.cloneNode(true);
            const newNoBtn = noBtn.cloneNode(true);
            yesBtn.parentNode.replaceChild(newYesBtn, yesBtn);
            noBtn.parentNode.replaceChild(newNoBtn, noBtn);
            
            // 添加新的事件监听器
            newYesBtn.addEventListener('click', function() {
                dialog.style.display = 'none';
                if (callback) callback(true);
            });
            
            newNoBtn.addEventListener('click', function() {
                dialog.style.display = 'none';
                if (callback) callback(false);
            });
        }
        
        // 初始化数据
        function initData() {
            // 从localStorage加载数据或设置默认值
            if (!localStorage.getItem('accountBalances')) {
                localStorage.setItem('accountBalances', JSON.stringify({
                    ozon: 0,
                    wb: 0,
                    individual: 0,
                    cash: 0
                }));
            }
            
            if (!localStorage.getItem('settings')) {
                localStorage.setItem('settings', JSON.stringify({
                    productNames: ['商品A', '商品B', '商品C'],
                    colors: ['红色', '蓝色', '绿色'],
                    units: ['个', '件', '箱'],
                    incomeExpenseTypes: ['费用支出', '销售货款'],
                    incomeExpenseForms: ['现金支付', '公账支付', '现金收入', '公账收入'],
                    currencies: ['人民币', '美元', '卢布'],
                    paymentRelations: ['张三,1234567890', '李四,0987654321'],
                    paymentMethods: ['银行转账', '支付宝', '微信支付']
                }));
            }
            
            if (!localStorage.getItem('products')) {
                localStorage.setItem('products', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('shipping')) {
                localStorage.setItem('shipping', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('records')) {
                localStorage.setItem('records', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('payments')) {
                localStorage.setItem('payments', JSON.stringify([]));
            }
            
            // 更新概览页面显示
            updateOverview();
            
            // 更新设置页面
            updateSettings();
            
            // 更新下拉选项
            updateDropdownOptions();
            
            // 初始化付款状态页面
            initPaymentStatusPage();
            initPaymentStatusPageShipping();
            initPaymentStatusPageProducts();
            initPaymentStatusPagePayment();
            
            // 初始化导出功能
            initExportFunctions();
        }
        
        // 初始化导出功能
        function initExportFunctions() {
            // 商品清单导出
            document.getElementById('exportProductsBtn').addEventListener('click', function() {
                exportTableToExcel('paymentTableBodyProducts', '商品清单');
            });
            
            // 运费支出导出
            document.getElementById('exportShippingBtn').addEventListener('click', function() {
                exportTableToExcel('paymentTableBodyShipping', '运费支出');
            });
            
            // 收支记录导出
            document.getElementById('exportRecordsBtn').addEventListener('click', function() {
                exportTableToExcel('paymentTableBody', '收支记录');
            });
            
            // 货款支付导出
            document.getElementById('exportPaymentBtn').addEventListener('click', function() {
                exportTableToExcel('paymentTableBodyPayment', '货款支付');
            });
            
            // 总表导出
            document.getElementById('exportAllDataBtn').addEventListener('click', function() {
                exportAllDataToExcel();
            });
        }
        
        // 导出表格为Excel
        function exportTableToExcel(tableId, sheetName) {
            const table = document.getElementById(tableId);
            if (!table) {
                showMessage('没有找到表格数据', 'error');
                return;
            }
            
            // 获取表头
            const headers = [];
            const headerRow = table.previousElementSibling.querySelectorAll('th');
            headerRow.forEach(th => {
                // 跳过选择列
                if (!th.querySelector('input[type="checkbox"]')) {
                    headers.push(th.textContent.replace('▼', '').trim());
                }
            });
            
            // 获取数据行
            const data = [];
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const rowData = [];
                const cells = row.querySelectorAll('td');
                cells.forEach((cell, index) => {
                    // 跳过选择列
                    if (index > 0) {
                        // 处理可编辑字段
                        if (cell.querySelector('select')) {
                            rowData.push(cell.querySelector('select').value);
                        } else if (cell.querySelector('textarea')) {
                            rowData.push(cell.querySelector('textarea').value);
                        } else {
                            rowData.push(cell.textContent.trim());
                        }
                    }
                });
                if (rowData.length > 0) {
                    data.push(rowData);
                }
            });
            
            // 创建工作簿
            const wb = XLSX.utils.book_new();
            const wsData = [headers, ...data];
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // 将工作表添加到工作簿
            XLSX.utils.book_append_sheet(wb, ws, sheetName);
            
            // 生成Excel文件并下载
            XLSX.writeFile(wb, `${sheetName}_${new Date().toISOString().slice(0, 10)}.xlsx`);
            
            showMessage(`${sheetName}导出成功！`, 'success');
        }
        
        // 导出所有数据为Excel
        function exportAllDataToExcel() {
            const wb = XLSX.utils.book_new();
            
            // 导出账户余额
            const balances = JSON.parse(localStorage.getItem('accountBalances'));
            const balanceData = [
                ['账户类型', '余额(₽)'],
                ['OZON账户余额', balances.ozon],
                ['WB账户余额', balances.wb],
                ['个体账户余额', balances.individual],
                ['现金余额', balances.cash],
                ['总金额', balances.ozon + balances.wb + balances.individual + balances.cash]
            ];
            const balanceWs = XLSX.utils.aoa_to_sheet(balanceData);
            XLSX.utils.book_append_sheet(wb, balanceWs, '账户余额');
            
            // 导出商品清单
            const productsData = JSON.parse(localStorage.getItem('products') || '[]');
            if (productsData.length > 0) {
                const productHeaders = ['日期', '商品名称', '颜色', '数量', '单位', '单价(¥)', '汇率', '折合卢布', '金额(¥)', '金额(₽)', '描述'];
                const productRows = productsData.map(item => [
                    item.date, item.productName, item.color, item.quantity, item.unit, 
                    item.unitPrice, item.exchangeRate, item.rublePrice, item.cnyAmount, item.rubleAmount, item.description
                ]);
                const productWs = XLSX.utils.aoa_to_sheet([productHeaders, ...productRows]);
                XLSX.utils.book_append_sheet(wb, productWs, '商品清单');
            }
            
            // 导出运费支出
            const shippingData = JSON.parse(localStorage.getItem('shipping') || '[]');
            if (shippingData.length > 0) {
                const shippingHeaders = ['日期', '商品名称', '货号', '件数', '重量(Kg)', '体积m³', '运费', '币种', '汇率', '折合卢布', '托盘费(₽)', '立方费(₽)', '送货车费(₽)', '运费总计(₽)', '结算', '备注'];
                const shippingRows = shippingData.map(item => [
                    item.date, item.product, item.code, item.quantity, item.weight, item.volume,
                    item.fee, item.currency, item.exchangeRate, item.rubleEquivalent, 
                    item.palletFee, item.cubeFee, item.deliveryFee, item.total, item.settlement, item.notes
                ]);
                const shippingWs = XLSX.utils.aoa_to_sheet([shippingHeaders, ...shippingRows]);
                XLSX.utils.book_append_sheet(wb, shippingWs, '运费支出');
            }
            
            // 导出收支记录
            const recordsData = JSON.parse(localStorage.getItem('records') || '[]');
            if (recordsData.length > 0) {
                const recordsHeaders = ['日期', '收支类型', '金额(₽)', '收支形式', '结算', '描述'];
                const recordsRows = recordsData.map(item => [
                    item.date, item.type, item.amount, item.form, item.settlement, item.description
                ]);
                const recordsWs = XLSX.utils.aoa_to_sheet([recordsHeaders, ...recordsRows]);
                XLSX.utils.book_append_sheet(wb, recordsWs, '收支记录');
            }
            
            // 导出货款支付
            const paymentsData = JSON.parse(localStorage.getItem('payments') || '[]');
            if (paymentsData.length > 0) {
                const paymentsHeaders = ['日期', '收款人', '账号', '支付方式', '金额(¥)', '结算', '备注'];
                const paymentsRows = paymentsData.map(item => [
                    item.date, item.recipient, item.account, item.method, item.amount, item.settlement, item.notes
                ]);
                const paymentsWs = XLSX.utils.aoa_to_sheet([paymentsHeaders, ...paymentsRows]);
                XLSX.utils.book_append_sheet(wb, paymentsWs, '货款支付');
            }
            
            // 生成Excel文件并下载
            XLSX.writeFile(wb, `电商合作账簿总表_${new Date().toISOString().slice(0, 10)}.xlsx`);
            
            showMessage('总表导出成功！', 'success');
        }
        
        // 更新概览页面
        function updateOverview() {
            const balances = JSON.parse(localStorage.getItem('accountBalances'));
            
            document.getElementById('ozon-balance').textContent = formatNumber(balances.ozon);
            document.getElementById('wb-balance').textContent = formatNumber(balances.wb);
            document.getElementById('individual-balance').textContent = formatNumber(balances.individual);
            document.getElementById('cash-balance').textContent = formatNumber(balances.cash);
            
            const total = balances.ozon + balances.wb + balances.individual + balances.cash;
            document.getElementById('total-balance').textContent = formatNumber(total);
        }
        
        // 更新设置页面
        function updateSettings() {
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            document.getElementById('product-names-list').value = settings.productNames.join('\n');
            document.getElementById('colors-list').value = settings.colors.join('\n');
            document.getElementById('units-list').value = settings.units.join('\n');
            document.getElementById('income-expense-types').value = settings.incomeExpenseTypes.join('\n');
            document.getElementById('income-expense-forms').value = settings.incomeExpenseForms.join('\n');
            document.getElementById('currency-list').value = settings.currencies.join('\n');
            document.getElementById('payment-relations').value = settings.paymentRelations.join('\n');
            document.getElementById('payment-methods-list').value = settings.paymentMethods.join('\n');
        }
        
        // 更新下拉选项
        function updateDropdownOptions() {
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            // 更新商品清单页面的下拉选项
            const colorSelect = document.getElementById('color-select');
            colorSelect.innerHTML = '<option value="">选择颜色</option>';
            settings.colors.forEach(color => {
                const option = document.createElement('option');
                option.value = color;
                option.textContent = color;
                colorSelect.appendChild(option);
            });
            
            const unitSelect = document.getElementById('unit-select');
            unitSelect.innerHTML = '<option value="件" selected>件</option>';
            settings.units.forEach(unit => {
                if (unit !== '件') {
                    const option = document.createElement('option');
                    option.value = unit;
                    option.textContent = unit;
                    unitSelect.appendChild(option);
                }
            });
            
            // 更新运费支出页面的下拉选项
            const currencySelect = document.getElementById('shipping-currency');
            currencySelect.innerHTML = '<option value="">选择币种</option>';
            settings.currencies.forEach(currency => {
                const option = document.createElement('option');
                option.value = currency;
                option.textContent = currency;
                currencySelect.appendChild(option);
            });
            
            // 更新收支记录页面的下拉选项
            const recordTypeSelect = document.getElementById('record-type');
            recordTypeSelect.innerHTML = '<option value="">选择收支类型</option>';
            settings.incomeExpenseTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                recordTypeSelect.appendChild(option);
            });
            
            const recordFormSelect = document.getElementById('record-form');
            recordFormSelect.innerHTML = '<option value="">选择收支形式</option>';
            settings.incomeExpenseForms.forEach(form => {
                const option = document.createElement('option');
                option.value = form;
                option.textContent = form;
                recordFormSelect.appendChild(option);
            });
            
            // 更新货款支付页面的下拉选项
            const paymentMethodSelect = document.getElementById('payment-method');
            paymentMethodSelect.innerHTML = '<option value="">选择支付方式</option>';
            settings.paymentMethods.forEach(method => {
                const option = document.createElement('option');
                option.value = method;
                option.textContent = method;
                paymentMethodSelect.appendChild(option);
            });
        }
        
        // 更新账户余额
        document.getElementById('update-balance').addEventListener('click', function() {
            showConfirm('确定要更新账户余额吗？', function(result) {
                if (result) {
                    const ozonValue = unformatNumber(document.getElementById('ozon-input').value) || 0;
                    const wbValue = unformatNumber(document.getElementById('wb-input').value) || 0;
                    const individualValue = unformatNumber(document.getElementById('individual-input').value) || 0;
                    
                    const balances = {
                        ozon: ozonValue,
                        wb: wbValue,
                        individual: individualValue,
                        cash: 0 // 现金余额通过其他页面计算
                    };
                    
                    localStorage.setItem('accountBalances', JSON.stringify(balances));
                    updateOverview();
                    
                    // 清空输入框
                    document.getElementById('ozon-input').value = '';
                    document.getElementById('wb-input').value = '';
                    document.getElementById('individual-input').value = '';
                    
                    showMessage('账户余额已更新！', 'success');
                }
            });
        });
        
        // 保存设置
        document.getElementById('save-settings').addEventListener('click', function() {
            const settings = {
                productNames: document.getElementById('product-names-list').value.split('\n').filter(item => item.trim()),
                colors: document.getElementById('colors-list').value.split('\n').filter(item => item.trim()),
                units: document.getElementById('units-list').value.split('\n').filter(item => item.trim()),
                incomeExpenseTypes: document.getElementById('income-expense-types').value.split('\n').filter(item => item.trim()),
                incomeExpenseForms: document.getElementById('income-expense-forms').value.split('\n').filter(item => item.trim()),
                currencies: document.getElementById('currency-list').value.split('\n').filter(item => item.trim()),
                paymentRelations: document.getElementById('payment-relations').value.split('\n').filter(item => item.trim()),
                paymentMethods: document.getElementById('payment-methods-list').value.split('\n').filter(item => item.trim())
            };
            
            localStorage.setItem('settings', JSON.stringify(settings));
            updateDropdownOptions();
            showMessage('设置已保存！', 'success');
        });
        
        // 删除所有数据
        document.getElementById('delete-all-data').addEventListener('click', function() {
            showConfirm('确定要删除所有数据吗？此操作不可恢复！', function(result) {
                if (result) {
                    localStorage.clear();
                    initData();
                    showMessage('所有数据已删除！', 'success');
                }
            });
        });
        
        // 商品名称智能输入
        document.getElementById('product-name').addEventListener('input', function() {
            const input = this.value;
            const dropdown = document.getElementById('product-name-dropdown');
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            dropdown.innerHTML = '';
            
            if (input.length > 0) {
                const matches = settings.productNames.filter(name => 
                    name.toLowerCase().includes(input.toLowerCase())
                );
                
                matches.forEach(match => {
                    const div = document.createElement('div');
                    div.textContent = match;
                    div.addEventListener('click', function() {
                        document.getElementById('product-name').value = match;
                        dropdown.style.display = 'none';
                    });
                    dropdown.appendChild(div);
                });
                
                if (matches.length > 0) {
                    dropdown.style.display = 'block';
                } else {
                    dropdown.style.display = 'none';
                }
            } else {
                dropdown.style.display = 'none';
            }
        });
        
        // 运费支出页面的商品名称智能输入
        document.getElementById('shipping-product').addEventListener('input', function() {
            const input = this.value;
            const dropdown = document.getElementById('shipping-product-dropdown');
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            dropdown.innerHTML = '';
            
            if (input.length > 0) {
                const matches = settings.productNames.filter(name => 
                    name.toLowerCase().includes(input.toLowerCase())
                );
                
                matches.forEach(match => {
                    const div = document.createElement('div');
                    div.textContent = match;
                    div.addEventListener('click', function() {
                        document.getElementById('shipping-product').value = match;
                        dropdown.style.display = 'none';
                    });
                    dropdown.appendChild(div);
                });
                
                if (matches.length > 0) {
                    dropdown.style.display = 'block';
                } else {
                    dropdown.style.display = 'none';
                }
            } else {
                dropdown.style.display = 'none';
            }
        });
        
        // 日期输入格式化
        document.querySelectorAll('input[placeholder="YYYYMMDD"]').forEach(input => {
            input.addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                
                if (value.length > 8) {
                    value = value.substring(0, 8);
                }
                
                if (value.length === 8) {
                    this.value = formatDate(value);
                } else {
                    this.value = value;
                }
            });
        });
        
        // 计算商品金额
        function calculateProductAmounts() {
            const quantity = unformatNumber(document.getElementById('quantity').value) || 0;
            const unitPrice = unformatNumber(document.getElementById('unit-price').value) || 0;
            const exchangeRate = unformatNumber(document.getElementById('exchange-rate').value) || 0;
            
            // 计算金额(¥)
            const cnyAmount = quantity * unitPrice;
            document.getElementById('cny-amount').textContent = formatNumber(cnyAmount);
            
            // 计算折合卢布
            let rublePrice = 0;
            if (exchangeRate > 1) {
                rublePrice = unitPrice * exchangeRate;
            } else if (exchangeRate > 0) {
                rublePrice = unitPrice / exchangeRate;
            }
            document.getElementById('ruble-price').textContent = formatNumber(rublePrice);
            
            // 计算金额(₽)
            const rubleAmount = quantity * rublePrice;
            document.getElementById('ruble-amount').textContent = formatNumber(rubleAmount);
        }
        
        // 监听数量、单价、汇率变化
        document.getElementById('quantity').addEventListener('input', calculateProductAmounts);
        document.getElementById('unit-price').addEventListener('input', calculateProductAmounts);
        document.getElementById('exchange-rate').addEventListener('input', calculateProductAmounts);
        
        // 计算运费
        function calculateShipping() {
            const shippingFee = unformatNumber(document.getElementById('shipping-fee').value) || 0;
            const exchangeRate = unformatNumber(document.getElementById('shipping-exchange-rate').value) || 0;
            const currency = document.getElementById('shipping-currency').value;
            
            // 计算折合卢布
            let rubleEquivalent = 0;
            if (currency !== '卢布') {
                if (exchangeRate > 1) {
                    rubleEquivalent = shippingFee * exchangeRate;
                } else if (exchangeRate > 0) {
                    rubleEquivalent = shippingFee / exchangeRate;
                }
            } else {
                rubleEquivalent = shippingFee;
            }
            document.getElementById('shipping-ruble').textContent = formatNumber(rubleEquivalent);
            
            // 计算运费总计
            const palletFee = unformatNumber(document.getElementById('pallet-fee').value) || 0;
            const cubeFee = unformatNumber(document.getElementById('cube-fee').value) || 0;
            const deliveryFee = unformatNumber(document.getElementById('delivery-fee').value) || 0;
            
            const shippingTotal = rubleEquivalent + palletFee + cubeFee + deliveryFee;
            document.getElementById('shipping-total').textContent = formatNumber(shippingTotal);
            
            // 显示/隐藏折合卢布框
            if (currency === '卢布') {
                document.getElementById('shipping-ruble').classList.add('hidden');
                document.querySelector('label[for="shipping-ruble"]').classList.add('hidden');
            } else {
                document.getElementById('shipping-ruble').classList.remove('hidden');
                document.querySelector('label[for="shipping-ruble"]').classList.remove('hidden');
            }
        }
        
        // 监听运费相关输入变化
        document.getElementById('shipping-fee').addEventListener('input', calculateShipping);
        document.getElementById('shipping-exchange-rate').addEventListener('input', calculateShipping);
        document.getElementById('shipping-currency').addEventListener('change', calculateShipping);
        document.getElementById('pallet-fee').addEventListener('input', calculateShipping);
        document.getElementById('cube-fee').addEventListener('input', calculateShipping);
        document.getElementById('delivery-fee').addEventListener('input', calculateShipping);
        
        // 收支类型和形式的关联
        document.getElementById('record-type').addEventListener('change', function() {
            const type = this.value;
            const formSelect = document.getElementById('record-form');
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            formSelect.innerHTML = '<option value="">选择收支形式</option>';
            
            if (type === '费用支出') {
                settings.incomeExpenseForms.forEach(form => {
                    if (form === '现金支付' || form === '公账支付') {
                        const option = document.createElement('option');
                        option.value = form;
                        option.textContent = form;
                        formSelect.appendChild(option);
                    }
                });
            } else if (type === '销售货款') {
                settings.incomeExpenseForms.forEach(form => {
                    if (form === '现金收入' || form === '公账收入') {
                        const option = document.createElement('option');
                        option.value = form;
                        option.textContent = form;
                        formSelect.appendChild(option);
                    }
                });
            } else {
                settings.incomeExpenseForms.forEach(form => {
                    const option = document.createElement('option');
                    option.value = form;
                    option.textContent = form;
                    formSelect.appendChild(option);
                });
            }
        });
        
        // 收款人智能输入
        document.getElementById('payment-recipient').addEventListener('input', function() {
            const input = this.value;
            const dropdown = document.getElementById('recipient-dropdown');
            const settings = JSON.parse(localStorage.getItem('settings'));
            
            dropdown.innerHTML = '';
            
            if (input.length > 0) {
                const matches = settings.paymentRelations.filter(rel => {
                    const parts = rel.split(',');
                    return parts.length > 0 && parts[0].toLowerCase().includes(input.toLowerCase());
                });
                
                matches.forEach(match => {
                    const parts = match.split(',');
                    const div = document.createElement('div');
                    div.textContent = parts[0];
                    div.addEventListener('click', function() {
                        document.getElementById('payment-recipient').value = parts[0];
                        if (parts.length > 1) {
                            document.getElementById('payment-account').value = parts[1];
                        }
                        dropdown.style.display = 'none';
                    });
                    dropdown.appendChild(div);
                });
                
                if (matches.length > 0) {
                    dropdown.style.display = 'block';
                } else {
                    dropdown.style.display = 'none';
                }
            } else {
                dropdown.style.display = 'none';
            }
        });
        
        // 收支记录数据
        let paymentData = [];
        let filteredPaymentData = null;
        let currentFilters = {
            date: [],
            type: [],
            form: [],
            settlement: [],
            description: []
        };

        // 商品清单页面数据
        let paymentDataProducts = [];
        let filteredPaymentDataProducts = null;
        let currentFiltersProducts = {
            date: [],
            productName: [],
            color: [],
            quantity: [],
            unit: [],
            unitPrice: [],
            exchangeRate: [],
            rublePrice: [],
            cnyAmount: [],
            rubleAmount: [],
            description: []
        };

        // 货款支付页面数据
        let paymentDataPayment = [];
        let filteredPaymentDataPayment = null;
        let currentFiltersPayment = {
            date: [],
            recipient: [],
            account: [],
            method: [],
            amount: [],
            settlement: [],
            notes: []
        };

        // 运费页面数据
        let paymentDataShipping = [];
        let filteredPaymentDataShipping = null;
        let currentFiltersShipping = {
            date: [],
            product: [],
            code: [],
            quantity: [],
            weight: [],
            volume: [],
            fee: [],
            currency: [],
            exchangeRate: [],
            rubleEquivalent: [],
            palletFee: [],
            cubeFee: [],
            deliveryFee: [],
            total: [],
            settlement: [],
            notes: []
        };

        // 收支记录页面功能
        function initPaymentStatusPage() {
            // 加载付款数据
            loadPaymentData();
            
            // 添加付款记录按钮
            document.getElementById('addPaymentBtn').addEventListener('click', function() {
                addPaymentRecord();
            });
            
            // 删除付款记录按钮
            document.getElementById('deletePaymentBtn').addEventListener('click', function() {
                deleteSelectedPayments();
            });
            
            // 取消筛选按钮
            document.getElementById('clearFilterBtn').addEventListener('click', function() {
                clearAllFilters();
            });
            
            // 全选复选框 - 修复全选功能
            document.getElementById('selectAllPayments').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#paymentTableBody .payment-checkbox');
                checkboxes.forEach(cb => {
                    cb.checked = this.checked;
                });
            });
            
            // 清除筛选按钮
            document.getElementById('clearFilter').addEventListener('click', function() {
                clearAllFilters();
            });
            
            // 筛选按钮 - 修复筛选功能
            document.querySelectorAll('.payment-table th .filter-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const column = this.getAttribute('data-column');
                    if (column === 'date') {
                        showDateFilterDropdown(this, column);
                    } else if (column === 'settlement') {
                        showSettlementFilterDropdown(this, column);
                    } else {
                        showFilterDropdown(this, column);
                    }
                });
            });
            
            // 渲染付款表格
            renderPaymentTable();
        }
        
        // 商品清单页面的付款状态功能
        function initPaymentStatusPageProducts() {
            // 加载付款数据
            loadPaymentDataProducts();
            
            // 添加付款记录按钮
            document.getElementById('addPaymentBtnProducts').addEventListener('click', function() {
                addPaymentRecordProducts();
            });
            
            // 删除付款记录按钮
            document.getElementById('deletePaymentBtnProducts').addEventListener('click', function() {
                deleteSelectedPaymentsProducts();
            });
            
            // 取消筛选按钮
            document.getElementById('clearFilterBtnProducts').addEventListener('click', function() {
                clearAllFiltersProducts();
            });
            
            // 全选复选框 - 修复全选功能
            document.getElementById('selectAllPaymentsProducts').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#paymentTableBodyProducts .payment-checkbox');
                checkboxes.forEach(cb => {
                    cb.checked = this.checked;
                });
            });
            
            // 清除筛选按钮
            document.getElementById('clearFilterProducts').addEventListener('click', function() {
                clearAllFiltersProducts();
            });
            
            // 筛选按钮 - 修复筛选功能
            document.querySelectorAll('#products-page .payment-table th .filter-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const column = this.getAttribute('data-column');
                    if (column === 'date') {
                        showDateFilterDropdownProducts(this, column);
                    } else {
                        showFilterDropdownProducts(this, column);
                    }
                });
            });
            
            // 渲染付款表格
            renderPaymentTableProducts();
        }
        
        // 货款支付页面的付款状态功能
        function initPaymentStatusPagePayment() {
            // 加载付款数据
            loadPaymentDataPayment();
            
            // 添加付款记录按钮
            document.getElementById('addPaymentBtnPayment').addEventListener('click', function() {
                addPaymentRecordPayment();
            });
            
            // 删除付款记录按钮
            document.getElementById('deletePaymentBtnPayment').addEventListener('click', function() {
                deleteSelectedPaymentsPayment();
            });
            
            // 取消筛选按钮
            document.getElementById('clearFilterBtnPayment').addEventListener('click', function() {
                clearAllFiltersPayment();
            });
            
            // 全选复选框 - 修复全选功能
            document.getElementById('selectAllPaymentsPayment').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#paymentTableBodyPayment .payment-checkbox');
                checkboxes.forEach(cb => {
                    cb.checked = this.checked;
                });
            });
            
            // 清除筛选按钮
            document.getElementById('clearFilterPayment').addEventListener('click', function() {
                clearAllFiltersPayment();
            });
            
            // 筛选按钮 - 修复筛选功能
            document.querySelectorAll('#payment-page .payment-table th .filter-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const column = this.getAttribute('data-column');
                    if (column === 'date') {
                        showDateFilterDropdownPayment(this, column);
                    } else if (column === 'settlement') {
                        showSettlementFilterDropdownPayment(this, column);
                    } else {
                        showFilterDropdownPayment(this, column);
                    }
                });
            });
            
            // 渲染付款表格
            renderPaymentTablePayment();
        }
        
        // 运费页面的付款状态功能
        function initPaymentStatusPageShipping() {
            // 加载付款数据
            loadPaymentDataShipping();
            
            // 添加付款记录按钮
            document.getElementById('addPaymentBtnShipping').addEventListener('click', function() {
                addPaymentRecordShipping();
            });
            
            // 删除付款记录按钮
            document.getElementById('deletePaymentBtnShipping').addEventListener('click', function() {
                deleteSelectedPaymentsShipping();
            });
            
            // 取消筛选按钮
            document.getElementById('clearFilterBtnShipping').addEventListener('click', function() {
                clearAllFiltersShipping();
            });
            
            // 全选复选框 - 修复全选功能
            document.getElementById('selectAllPaymentsShipping').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('#paymentTableBodyShipping .payment-checkbox');
                checkboxes.forEach(cb => {
                    cb.checked = this.checked;
                });
            });
            
            // 清除筛选按钮
            document.getElementById('clearFilterShipping').addEventListener('click', function() {
                clearAllFiltersShipping();
            });
            
            // 筛选按钮 - 修复筛选功能
            document.querySelectorAll('#shipping-page .payment-table th .filter-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const column = this.getAttribute('data-column');
                    if (column === 'date') {
                        showDateFilterDropdownShipping(this, column);
                    } else if (column === 'settlement') {
                        showSettlementFilterDropdownShipping(this, column);
                    } else {
                        showFilterDropdownShipping(this, column);
                    }
                });
            });
            
            // 渲染付款表格
            renderPaymentTableShipping();
        }
        
        function loadPaymentData() {
            const saved = localStorage.getItem('paymentData');
            if (saved) {
                paymentData = JSON.parse(saved);
            } else {
                // 默认数据
                paymentData = [];
            }
        }
        
        function loadPaymentDataProducts() {
            const saved = localStorage.getItem('paymentDataProducts');
            if (saved) {
                paymentDataProducts = JSON.parse(saved);
            } else {
                // 默认数据
                paymentDataProducts = [];
            }
        }
        
        function loadPaymentDataPayment() {
            const saved = localStorage.getItem('paymentDataPayment');
            if (saved) {
                paymentDataPayment = JSON.parse(saved);
            } else {
                // 默认数据
                paymentDataPayment = [];
            }
        }
        
        function loadPaymentDataShipping() {
            const saved = localStorage.getItem('paymentDataShipping');
            if (saved) {
                paymentDataShipping = JSON.parse(saved);
            } else {
                // 默认数据
                paymentDataShipping = [];
            }
        }
        
        function savePaymentData() {
            localStorage.setItem('paymentData', JSON.stringify(paymentData));
        }
        
        function savePaymentDataProducts() {
            localStorage.setItem('paymentDataProducts', JSON.stringify(paymentDataProducts));
        }
        
        function savePaymentDataPayment() {
            localStorage.setItem('paymentDataPayment', JSON.stringify(paymentDataPayment));
        }
        
        function savePaymentDataShipping() {
            localStorage.setItem('paymentDataShipping', JSON.stringify(paymentDataShipping));
        }
        
        function renderPaymentTable(data = null) {
            const tbody = document.getElementById('paymentTableBody');
            tbody.innerHTML = '';
            
            const displayData = data || paymentData;
            filteredPaymentData = data ? paymentData.filter(item => 
                displayData.some(d => d.id === item.id)
            ) : null;
            
            displayData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="select-row">
                        <input type="checkbox" class="payment-checkbox" data-id="${item.id}">
                    </td>
                    <td class="date-cell">${item.date}</td>
                    <td class="income-expense-type-cell">${item.type}</td>
                    <td class="cny-amount-cell">${formatNumber(item.amount)}</td>
                    <td class="income-expense-form-cell">${item.form}</td>
                    <td class="settlement-cell">
                        <select class="settlement-select" data-id="${item.id}">
                            <option value="未结算" ${item.settlement === '未结算' || !item.settlement ? 'selected' : ''}>未结算</option>
                            <option value="已结算" ${item.settlement === '已结算' ? 'selected' : ''}>已结算</option>
                        </select>
                    </td>
                    <td class="description-cell">
                        <textarea class="editable-notes" data-id="${item.id}">${item.description}</textarea>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // 添加结算状态变化事件监听
            document.querySelectorAll('#paymentTableBody .settlement-select').forEach(select => {
                select.addEventListener('change', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const value = this.value;
                    updateSettlementStatus(id, value);
                });
            });
            
            // 添加备注编辑事件监听
            document.querySelectorAll('#paymentTableBody .editable-notes').forEach(textarea => {
                textarea.addEventListener('blur', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const value = this.value;
                    updateNotes(id, value);
                });
            });
            
            updateTotals();
            updateFilterStatus();
        }
        
        function renderPaymentTableProducts(data = null) {
            const tbody = document.getElementById('paymentTableBodyProducts');
            tbody.innerHTML = '';
            
            const displayData = data || paymentDataProducts;
            filteredPaymentDataProducts = data ? paymentDataProducts.filter(item => 
                displayData.some(d => d.id === item.id)
            ) : null;
            
            displayData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="select-row">
                        <input type="checkbox" class="payment-checkbox" data-id="${item.id}">
                    </td>
                    <td class="date-cell">${item.date}</td>
                    <td class="product-name-cell">${item.productName}</td>
                    <td class="notes-cell">${item.color}</td>
                    <td class="quantity-cell">${item.quantity}</td>
                    <td class="unit-cell">${item.unit}</td>
                    <td class="unit-price-cell">${item.unitPrice}</td>
                    <td class="exchange-rate-cell">${item.exchangeRate}</td>
                    <td class="ruble-equivalent-cell">${item.rublePrice}</td>
                    <td class="cny-amount-cell">${item.cnyAmount}</td>
                    <td class="ruble-amount-cell">${item.rubleAmount}</td>
                    <td class="description-cell">
                        <textarea class="editable-notes" data-id="${item.id}">${item.description}</textarea>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // 添加备注编辑事件监听
            document.querySelectorAll('#paymentTableBodyProducts .editable-notes').forEach(textarea => {
                textarea.addEventListener('blur', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const value = this.value;
                    updateNotesProducts(id, value);
                });
            });
            
            updateTotalsProducts();
            updateFilterStatusProducts();
        }
        
        function renderPaymentTablePayment(data = null) {
            const tbody = document.getElementById('paymentTableBodyPayment');
            tbody.innerHTML = '';
            
            const displayData = data || paymentDataPayment;
            filteredPaymentDataPayment = data ? paymentDataPayment.filter(item => 
                displayData.some(d => d.id === item.id)
            ) : null;
            
            displayData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="select-row">
                        <input type="checkbox" class="payment-checkbox" data-id="${item.id}">
                    </td>
                    <td class="date-cell">${item.date}</td>
                    <td class="recipient-cell">${item.recipient}</td>
                    <td class="account-cell">${item.account}</td>
                    <td class="payment-method-cell">${item.method}</td>
                    <td class="cny-amount-cell">${formatNumber(item.amount)}</td>
                    <td class="settlement-cell">
                        <select class="settlement-select" data-id="${item.id}">
                            <option value="未结算" ${item.settlement === '未结算' || !item.settlement ? 'selected' : ''}>未结算</option>
                            <option value="已结算" ${item.settlement === '已结算' ? 'selected' : ''}>已结算</option>
                        </select>
                    </td>
                    <td class="notes-cell">
                        <textarea class="editable-notes" data-id="${item.id}">${item.notes}</textarea>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // 添加结算状态变化事件监听
            document.querySelectorAll('#paymentTableBodyPayment .settlement-select').forEach(select => {
                select.addEventListener('change', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const value = this.value;
                    updateSettlementStatusPayment(id, value);
                });
            });
            
            // 添加备注编辑事件监听
            document.querySelectorAll('#paymentTableBodyPayment .editable-notes').forEach(textarea => {
                textarea.addEventListener('blur', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const value = this.value;
                    updateNotesPayment(id, value);
                });
            });
            
            updateTotalsPayment();
            updateFilterStatusPayment();
        }
        
        function renderPaymentTableShipping(data = null) {
            const tbody = document.getElementById('paymentTableBodyShipping');
            tbody.innerHTML = '';
            
            const displayData = data || paymentDataShipping;
            filteredPaymentDataShipping = data ? paymentDataShipping.filter(item => 
                displayData.some(d => d.id === item.id)
            ) : null;
            
            displayData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="select-row">
                        <input type="checkbox" class="payment-checkbox" data-id="${item.id}">
                    </td>
                    <td class="date-cell">${item.date}</td>
                    <td class="product-name-cell">${item.product}</td>
                    <td class="code-cell">${item.code}</td>
                    <td class="quantity-cell">${item.quantity}</td>
                    <td class="weight-cell">${item.weight}</td>
                    <td class="volume-cell">${item.volume}</td>
                    <td class="fee-cell">${item.fee}</td>
                    <td class="currency-cell">${item.currency}</td>
                    <td class="exchange-rate-cell">${item.exchangeRate}</td>
                    <td class="ruble-equivalent-cell">${item.rubleEquivalent}</td>
                    <td class="pallet-fee-cell">${item.palletFee}</td>
                    <td class="cube-fee-cell">${item.cubeFee}</td>
                    <td class="delivery-fee-cell">${item.deliveryFee}</td>
                    <td class="total-cell">${item.total}</td>
                    <td class="settlement-cell">
                        <select class="settlement-select" data-id="${item.id}">
                            <option value="未结算" ${item.settlement === '未结算' || !item.settlement ? 'selected' : ''}>未结算</option>
                            <option value="已结算" ${item.settlement === '已结算' ? 'selected' : ''}>已结算</option>
                        </select>
                    </td>
                    <td class="notes-cell">
                        <textarea class="editable-notes" data-id="${item.id}">${item.notes}</textarea>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // 添加结算状态变化事件监听
            document.querySelectorAll('#paymentTableBodyShipping .settlement-select').forEach(select => {
                select.addEventListener('change', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const value = this.value;
                    updateSettlementStatusShipping(id, value);
                });
            });
            
            // 添加备注编辑事件监听
            document.querySelectorAll('#paymentTableBodyShipping .editable-notes').forEach(textarea => {
                textarea.addEventListener('blur', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const value = this.value;
                    updateNotesShipping(id, value);
                });
            });
            
            updateTotalsShipping();
            updateFilterStatusShipping();
        }
        
        function updateTotals() {
            // 计算总计
            const totalAmount = paymentData.reduce((sum, item) => {
                return sum + (parseInt(item.amount) || 0);
            }, 0);
            
            document.getElementById('totalAmount').textContent = formatNumber(totalAmount);
            
            // 计算筛选结果总计
            if (filteredPaymentData) {
                const filteredTotalAmount = filteredPaymentData.reduce((sum, item) => {
                    return sum + (parseInt(item.amount) || 0);
                }, 0);
                
                document.getElementById('filteredTotalAmount').textContent = formatNumber(filteredTotalAmount);
                document.getElementById('filteredTotalRow').style.display = '';
            } else {
                document.getElementById('filteredTotalRow').style.display = 'none';
            }
        }
        
        function updateTotalsProducts() {
            // 计算总计
            const totalAmount = paymentDataProducts.reduce((sum, item) => {
                return sum + (parseInt(item.rubleAmount) || 0);
            }, 0);
            
            document.getElementById('totalAmountProducts').textContent = formatNumber(totalAmount);
            
            // 计算筛选结果总计
            if (filteredPaymentDataProducts) {
                const filteredTotalAmount = filteredPaymentDataProducts.reduce((sum, item) => {
                    return sum + (parseInt(item.rubleAmount) || 0);
                }, 0);
                
                document.getElementById('filteredTotalAmountProducts').textContent = formatNumber(filteredTotalAmount);
                document.getElementById('filteredTotalRowProducts').style.display = '';
            } else {
                document.getElementById('filteredTotalRowProducts').style.display = 'none';
            }
        }
        
        function updateTotalsPayment() {
            // 计算总计
            const totalAmount = paymentDataPayment.reduce((sum, item) => {
                return sum + (parseInt(item.amount) || 0);
            }, 0);
            
            document.getElementById('totalAmountPayment').textContent = formatNumber(totalAmount);
            
            // 计算筛选结果总计
            if (filteredPaymentDataPayment) {
                const filteredTotalAmount = filteredPaymentDataPayment.reduce((sum, item) => {
                    return sum + (parseInt(item.amount) || 0);
                }, 0);
                
                document.getElementById('filteredTotalAmountPayment').textContent = formatNumber(filteredTotalAmount);
                document.getElementById('filteredTotalRowPayment').style.display = '';
            } else {
                document.getElementById('filteredTotalRowPayment').style.display = 'none';
            }
        }
        
        function updateTotalsShipping() {
            // 计算总计
            const totalAmount = paymentDataShipping.reduce((sum, item) => {
                return sum + (parseInt(item.total) || 0);
            }, 0);
            
            document.getElementById('totalAmountShipping').textContent = formatNumber(totalAmount);
            
            // 计算筛选结果总计
            if (filteredPaymentDataShipping) {
                const filteredTotalAmount = filteredPaymentDataShipping.reduce((sum, item) => {
                    return sum + (parseInt(item.total) || 0);
                }, 0);
                
                document.getElementById('filteredTotalAmountShipping').textContent = formatNumber(filteredTotalAmount);
                document.getElementById('filteredTotalRowShipping').style.display = '';
            } else {
                document.getElementById('filteredTotalRowShipping').style.display = 'none';
            }
        }
        
        function updateFilterStatus() {
            const filterStatus = document.getElementById('filterStatus');
            const filterTags = document.getElementById('filterTags');
            
            let hasFilters = false;
            let tagsHtml = '';
            
            Object.keys(currentFilters).forEach(key => {
                if (currentFilters[key].length > 0) {
                    hasFilters = true;
                    currentFilters[key].forEach(value => {
                        tagsHtml += `<span class="filter-tag">${key}: ${value}</span>`;
                    });
                }
            });
            
            if (hasFilters) {
                filterStatus.style.display = 'block';
                filterTags.innerHTML = tagsHtml;
            } else {
                filterStatus.style.display = 'none';
            }
        }
        
        function updateFilterStatusProducts() {
            const filterStatus = document.getElementById('filterStatusProducts');
            const filterTags = document.getElementById('filterTagsProducts');
            
            let hasFilters = false;
            let tagsHtml = '';
            
            Object.keys(currentFiltersProducts).forEach(key => {
                if (currentFiltersProducts[key].length > 0) {
                    hasFilters = true;
                    currentFiltersProducts[key].forEach(value => {
                        tagsHtml += `<span class="filter-tag">${key}: ${value}</span>`;
                    });
                }
            });
            
            if (hasFilters) {
                filterStatus.style.display = 'block';
                filterTags.innerHTML = tagsHtml;
            } else {
                filterStatus.style.display = 'none';
            }
        }
        
        function updateFilterStatusPayment() {
            const filterStatus = document.getElementById('filterStatusPayment');
            const filterTags = document.getElementById('filterTagsPayment');
            
            let hasFilters = false;
            let tagsHtml = '';
            
            Object.keys(currentFiltersPayment).forEach(key => {
                if (currentFiltersPayment[key].length > 0) {
                    hasFilters = true;
                    currentFiltersPayment[key].forEach(value => {
                        tagsHtml += `<span class="filter-tag">${key}: ${value}</span>`;
                    });
                }
            });
            
            if (hasFilters) {
                filterStatus.style.display = 'block';
                filterTags.innerHTML = tagsHtml;
            } else {
                filterStatus.style.display = 'none';
            }
        }
        
        function updateFilterStatusShipping() {
            const filterStatus = document.getElementById('filterStatusShipping');
            const filterTags = document.getElementById('filterTagsShipping');
            
            let hasFilters = false;
            let tagsHtml = '';
            
            Object.keys(currentFiltersShipping).forEach(key => {
                if (currentFiltersShipping[key].length > 0) {
                    hasFilters = true;
                    currentFiltersShipping[key].forEach(value => {
                        tagsHtml += `<span class="filter-tag">${key}: ${value}</span>`;
                    });
                }
            });
            
            if (hasFilters) {
                filterStatus.style.display = 'block';
                filterTags.innerHTML = tagsHtml;
            } else {
                filterStatus.style.display = 'none';
            }
        }
        
        // 添加收支记录
        function addPaymentRecord() {
            // 获取表单数据
            const date = document.getElementById('record-date').value;
            const type = document.getElementById('record-type').value;
            const form = document.getElementById('record-form').value;
            const amount = document.getElementById('record-amount').value;
            const description = document.getElementById('record-description').value;
            
            // 验证必填项
            if (!date || !type || !form || !amount || !description) {
                showMessage('请填写所有必填项！', 'error');
                return;
            }
            
            // 生成新ID
            const newId = paymentData.length > 0 ? Math.max(...paymentData.map(p => p.id)) + 1 : 1;
            
            // 添加新记录
            paymentData.push({
                id: newId,
                date,
                type,
                form,
                amount: unformatNumber(amount),
                description,
                settlement: '未结算' // 默认设置为未结算
            });
            
            // 保存数据
            savePaymentData();
            
            // 重新渲染表格
            renderPaymentTable();
            
            // 清空表单
            document.getElementById('record-date').value = '';
            document.getElementById('record-type').value = '';
            document.getElementById('record-form').value = '';
            document.getElementById('record-amount').value = '';
            document.getElementById('record-description').value = '';
            
            // 显示成功消息
            showMessage('收支记录已成功添加！', 'success');
        }
        
        function addPaymentRecordProducts() {
            // 获取表单数据
            const date = document.getElementById('arrival-date').value;
            const productName = document.getElementById('product-name').value;
            const color = document.getElementById('color-select').value;
            const quantity = document.getElementById('quantity').value;
            const unit = document.getElementById('unit-select').value;
            const unitPrice = document.getElementById('unit-price').value;
            const exchangeRate = document.getElementById('exchange-rate').value;
            const rublePrice = document.getElementById('ruble-price').textContent;
            const cnyAmount = document.getElementById('cny-amount').textContent;
            const rubleAmount = document.getElementById('ruble-amount').textContent;
            const description = document.getElementById('product-description').value;
            
            // 验证必填项
            if (!date || !productName || !quantity || !unitPrice || !exchangeRate) {
                showMessage('请填写所有必填项！', 'error');
                return;
            }
            
            // 生成新ID
            const newId = paymentDataProducts.length > 0 ? Math.max(...paymentDataProducts.map(p => p.id)) + 1 : 1;
            
            // 添加新记录
            paymentDataProducts.push({
                id: newId,
                date,
                productName,
                color,
                quantity,
                unit,
                unitPrice,
                exchangeRate,
                rublePrice,
                cnyAmount,
                rubleAmount,
                description
            });
            
            // 保存数据
            savePaymentDataProducts();
            
            // 重新渲染表格
            renderPaymentTableProducts();
            
            // 清空表单
            document.getElementById('arrival-date').value = '';
            document.getElementById('product-name').value = '';
            document.getElementById('color-select').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('unit-select').value = '';
            document.getElementById('unit-price').value = '';
            document.getElementById('exchange-rate').value = '';
            document.getElementById('product-description').value = '';
            
            // 显示成功消息
            showMessage('商品记录已成功添加！', 'success');
        }
        
        function addPaymentRecordPayment() {
            // 获取表单数据
            const date = document.getElementById('payment-date').value;
            const recipient = document.getElementById('payment-recipient').value;
            const account = document.getElementById('payment-account').value;
            const method = document.getElementById('payment-method').value;
            const amount = document.getElementById('payment-amount').value;
            const notes = document.getElementById('payment-notes').value;
            
            // 验证必填项
            if (!date || !recipient || !account || !method || !amount) {
                showMessage('请填写所有必填项！', 'error');
                return;
            }
            
            // 生成新ID
            const newId = paymentDataPayment.length > 0 ? Math.max(...paymentDataPayment.map(p => p.id)) + 1 : 1;
            
            // 添加新记录
            paymentDataPayment.push({
                id: newId,
                date,
                recipient,
                account,
                method,
                amount: unformatNumber(amount),
                notes,
                settlement: '未结算' // 默认设置为未结算
            });
            
            // 保存数据
            savePaymentDataPayment();
            
            // 重新渲染表格
            renderPaymentTablePayment();
            
            // 清空表单
            document.getElementById('payment-date').value = '';
            document.getElementById('payment-recipient').value = '';
            document.getElementById('payment-account').value = '';
            document.getElementById('payment-method').value = '';
            document.getElementById('payment-amount').value = '';
            document.getElementById('payment-notes').value = '';
            
            // 显示成功消息
            showMessage('货款支付记录已成功添加！', 'success');
        }
        
        function addPaymentRecordShipping() {
            // 获取表单数据
            const date = document.getElementById('shipping-date').value;
            const code = document.getElementById('shipping-code').value;
            const product = document.getElementById('shipping-product').value;
            const weight = document.getElementById('shipping-weight').value;
            const volume = document.getElementById('shipping-volume').value;
            const quantity = document.getElementById('shipping-quantity').value;
            const fee = document.getElementById('shipping-fee').value;
            const currency = document.getElementById('shipping-currency').value;
            const exchangeRate = document.getElementById('shipping-exchange-rate').value;
            const rubleEquivalent = document.getElementById('shipping-ruble').textContent;
            const palletFee = document.getElementById('pallet-fee').value;
            const cubeFee = document.getElementById('cube-fee').value;
            const deliveryFee = document.getElementById('delivery-fee').value;
            const total = document.getElementById('shipping-total').textContent;
            const notes = document.getElementById('shipping-notes').value;
            
            // 验证必填项 - 移除了件数的必填验证
            if (!date || !product || !weight || !fee || !currency || !exchangeRate) {
                showMessage('请填写所有必填项！', 'error');
                return;
            }
            
            // 生成新ID
            const newId = paymentDataShipping.length > 0 ? Math.max(...paymentDataShipping.map(p => p.id)) + 1 : 1;
            
            // 添加新记录
            paymentDataShipping.push({
                id: newId,
                date,
                code,
                product,
                weight,
                volume,
                quantity,
                fee,
                currency,
                exchangeRate,
                rubleEquivalent,
                palletFee,
                cubeFee,
                deliveryFee,
                total,
                notes,
                settlement: '未结算' // 默认设置为未结算
            });
            
            // 保存数据
            savePaymentDataShipping();
            
            // 重新渲染表格
            renderPaymentTableShipping();
            
            // 清空表单
            document.getElementById('shipping-date').value = '';
            document.getElementById('shipping-code').value = '';
            document.getElementById('shipping-product').value = '';
            document.getElementById('shipping-weight').value = '';
            document.getElementById('shipping-volume').value = '';
            document.getElementById('shipping-quantity').value = '';
            document.getElementById('shipping-fee').value = '';
            document.getElementById('shipping-currency').value = '';
            document.getElementById('shipping-exchange-rate').value = '';
            document.getElementById('pallet-fee').value = '';
            document.getElementById('cube-fee').value = '';
            document.getElementById('delivery-fee').value = '';
            document.getElementById('shipping-notes').value = '';
            
            // 显示成功消息
            showMessage('运费支出记录已成功添加！', 'success');
        }
        
        // 删除选中的收支记录
        function deleteSelectedPayments() {
            const checkboxes = document.querySelectorAll('#paymentTableBody .payment-checkbox:checked');
            if (checkboxes.length === 0) {
                showMessage('请先选择要删除的收支记录', 'error');
                return;
            }
            
            showConfirm(`确定要删除选中的 ${checkboxes.length} 条收支记录吗？`, function(result) {
                if (result) {
                    const idsToDelete = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-id')));
                    paymentData = paymentData.filter(item => !idsToDelete.includes(item.id));
                    
                    savePaymentData();
                    renderPaymentTable();
                    showMessage(`已删除 ${idsToDelete.length} 条收支记录`, 'success');
                }
            });
        }
        
        function deleteSelectedPaymentsProducts() {
            const checkboxes = document.querySelectorAll('#paymentTableBodyProducts .payment-checkbox:checked');
            if (checkboxes.length === 0) {
                showMessage('请先选择要删除的付款记录', 'error');
                return;
            }
            
            showConfirm(`确定要删除选中的 ${checkboxes.length} 条付款记录吗？`, function(result) {
                if (result) {
                    const idsToDelete = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-id')));
                    paymentDataProducts = paymentDataProducts.filter(item => !idsToDelete.includes(item.id));
                    
                    savePaymentDataProducts();
                    renderPaymentTableProducts();
                    showMessage('已删除选中的付款记录', 'success');
                }
            });
        }
        
        function deleteSelectedPaymentsPayment() {
            const checkboxes = document.querySelectorAll('#paymentTableBodyPayment .payment-checkbox:checked');
            if (checkboxes.length === 0) {
                showMessage('请先选择要删除的付款记录', 'error');
                return;
            }
            
            showConfirm(`确定要删除选中的 ${checkboxes.length} 条付款记录吗？`, function(result) {
                if (result) {
                    const idsToDelete = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-id')));
                    paymentDataPayment = paymentDataPayment.filter(item => !idsToDelete.includes(item.id));
                    
                    savePaymentDataPayment();
                    renderPaymentTablePayment();
                    showMessage('已删除选中的付款记录', 'success');
                }
            });
        }
        
        function deleteSelectedPaymentsShipping() {
            const checkboxes = document.querySelectorAll('#paymentTableBodyShipping .payment-checkbox:checked');
            if (checkboxes.length === 0) {
                showMessage('请先选择要删除的付款记录', 'error');
                return;
            }
            
            showConfirm(`确定要删除选中的 ${checkboxes.length} 条付款记录吗？`, function(result) {
                if (result) {
                    const idsToDelete = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-id')));
                    paymentDataShipping = paymentDataShipping.filter(item => !idsToDelete.includes(item.id));
                    
                    savePaymentDataShipping();
                    renderPaymentTableShipping();
                    showMessage('已删除选中的付款记录', 'success');
                }
            });
        }
        
        // 更新结算状态
        function updateSettlementStatus(id, value) {
            const item = paymentData.find(p => p.id === id);
            if (item) {
                item.settlement = value;
                savePaymentData();
            }
        }
        
        function updateSettlementStatusPayment(id, value) {
            const item = paymentDataPayment.find(p => p.id === id);
            if (item) {
                item.settlement = value;
                savePaymentDataPayment();
            }
        }
        
        function updateSettlementStatusShipping(id, value) {
            const item = paymentDataShipping.find(p => p.id === id);
            if (item) {
                item.settlement = value;
                savePaymentDataShipping();
            }
        }
        
        // 更新备注
        function updateNotes(id, value) {
            const item = paymentData.find(p => p.id === id);
            if (item) {
                item.description = value;
                savePaymentData();
            }
        }
        
        function updateNotesProducts(id, value) {
            const item = paymentDataProducts.find(p => p.id === id);
            if (item) {
                item.description = value;
                savePaymentDataProducts();
            }
        }
        
        function updateNotesPayment(id, value) {
            const item = paymentDataPayment.find(p => p.id === id);
            if (item) {
                item.notes = value;
                savePaymentDataPayment();
            }
        }
        
        function updateNotesShipping(id, value) {
            const item = paymentDataShipping.find(p => p.id === id);
            if (item) {
                item.notes = value;
                savePaymentDataShipping();
            }
        }
        
        // 结算状态筛选下拉框
        function showSettlementFilterDropdown(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加结算状态选项
            const statuses = ['未结算', '已结算'];
            
            statuses.forEach(status => {
                const item = document.createElement('div');
                item.className = 'filter-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'filter-checkbox';
                checkbox.value = status;
                checkbox.checked = currentFilters[column].includes(status);
                
                item.appendChild(checkbox);
                item.appendChild(document.createTextNode(status));
                dropdown.appendChild(item);
            });
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFilters[column] = selectedValues;
                applyFilter();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFilters[column] = [];
                applyFilter();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function showSettlementFilterDropdownPayment(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加结算状态选项
            const statuses = ['未结算', '已结算'];
            
            statuses.forEach(status => {
                const item = document.createElement('div');
                item.className = 'filter-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'filter-checkbox';
                checkbox.value = status;
                checkbox.checked = currentFiltersPayment[column].includes(status);
                
                item.appendChild(checkbox);
                item.appendChild(document.createTextNode(status));
                dropdown.appendChild(item);
            });
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFiltersPayment[column] = selectedValues;
                applyFilterPayment();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFiltersPayment[column] = [];
                applyFilterPayment();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function showSettlementFilterDropdownShipping(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加结算状态选项
            const statuses = ['未结算', '已结算'];
            
            statuses.forEach(status => {
                const item = document.createElement('div');
                item.className = 'filter-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'filter-checkbox';
                checkbox.value = status;
                checkbox.checked = currentFiltersShipping[column].includes(status);
                
                item.appendChild(checkbox);
                item.appendChild(document.createTextNode(status));
                dropdown.appendChild(item);
            });
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFiltersShipping[column] = selectedValues;
                applyFilterShipping();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFiltersShipping[column] = [];
                applyFilterShipping();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        // 日期筛选下拉框（按年、月、日）- 支持多选筛选
        function showDateFilterDropdown(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 获取所有日期并提取年、月、日
            const dates = paymentData.map(item => item.date);
            const years = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[0] : null;
            }))].filter(Boolean).sort().reverse();
            
            const months = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[1] : null;
            }))].filter(Boolean).sort().reverse();
            
            const days = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[2] : null;
            }))].filter(Boolean).sort().reverse();
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加年份筛选
            if (years.length > 0) {
                const yearHeader = document.createElement('div');
                yearHeader.className = 'filter-item';
                yearHeader.style.fontWeight = 'bold';
                yearHeader.textContent = '按年筛选:';
                dropdown.appendChild(yearHeader);
                
                years.forEach(year => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = year;
                    checkbox.checked = currentFilters.date.includes(year);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${year}年`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加月份筛选
            if (months.length > 0) {
                const monthHeader = document.createElement('div');
                monthHeader.className = 'filter-item';
                monthHeader.style.fontWeight = 'bold';
                monthHeader.textContent = '按月筛选:';
                dropdown.appendChild(monthHeader);
                
                months.forEach(month => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = month;
                    checkbox.checked = currentFilters.date.includes(month);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${month}月`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加日期筛选
            if (days.length > 0) {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'filter-item';
                dayHeader.style.fontWeight = 'bold';
                dayHeader.textContent = '按日筛选:';
                dropdown.appendChild(dayHeader);
                
                days.forEach(day => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = day;
                    checkbox.checked = currentFilters.date.includes(day);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${day}日`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFilters.date = selectedValues;
                applyDateFilter();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFilters.date = [];
                applyDateFilter();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function showDateFilterDropdownProducts(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 获取所有日期并提取年、月、日
            const dates = paymentDataProducts.map(item => item.date);
            const years = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[0] : null;
            }))].filter(Boolean).sort().reverse();
            
            const months = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[1] : null;
            }))].filter(Boolean).sort().reverse();
            
            const days = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[2] : null;
            }))].filter(Boolean).sort().reverse();
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加年份筛选
            if (years.length > 0) {
                const yearHeader = document.createElement('div');
                yearHeader.className = 'filter-item';
                yearHeader.style.fontWeight = 'bold';
                yearHeader.textContent = '按年筛选:';
                dropdown.appendChild(yearHeader);
                
                years.forEach(year => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = year;
                    checkbox.checked = currentFiltersProducts.date.includes(year);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${year}年`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加月份筛选
            if (months.length > 0) {
                const monthHeader = document.createElement('div');
                monthHeader.className = 'filter-item';
                monthHeader.style.fontWeight = 'bold';
                monthHeader.textContent = '按月筛选:';
                dropdown.appendChild(monthHeader);
                
                months.forEach(month => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = month;
                    checkbox.checked = currentFiltersProducts.date.includes(month);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${month}月`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加日期筛选
            if (days.length > 0) {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'filter-item';
                dayHeader.style.fontWeight = 'bold';
                dayHeader.textContent = '按日筛选:';
                dropdown.appendChild(dayHeader);
                
                days.forEach(day => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = day;
                    checkbox.checked = currentFiltersProducts.date.includes(day);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${day}日`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFiltersProducts.date = selectedValues;
                applyDateFilterProducts();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFiltersProducts.date = [];
                applyDateFilterProducts();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function showDateFilterDropdownPayment(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 获取所有日期并提取年、月、日
            const dates = paymentDataPayment.map(item => item.date);
            const years = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[0] : null;
            }))].filter(Boolean).sort().reverse();
            
            const months = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[1] : null;
            }))].filter(Boolean).sort().reverse();
            
            const days = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[2] : null;
            }))].filter(Boolean).sort().reverse();
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加年份筛选
            if (years.length > 0) {
                const yearHeader = document.createElement('div');
                yearHeader.className = 'filter-item';
                yearHeader.style.fontWeight = 'bold';
                yearHeader.textContent = '按年筛选:';
                dropdown.appendChild(yearHeader);
                
                years.forEach(year => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = year;
                    checkbox.checked = currentFiltersPayment.date.includes(year);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${year}年`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加月份筛选
            if (months.length > 0) {
                const monthHeader = document.createElement('div');
                monthHeader.className = 'filter-item';
                monthHeader.style.fontWeight = 'bold';
                monthHeader.textContent = '按月筛选:';
                dropdown.appendChild(monthHeader);
                
                months.forEach(month => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = month;
                    checkbox.checked = currentFiltersPayment.date.includes(month);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${month}月`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加日期筛选
            if (days.length > 0) {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'filter-item';
                dayHeader.style.fontWeight = 'bold';
                dayHeader.textContent = '按日筛选:';
                dropdown.appendChild(dayHeader);
                
                days.forEach(day => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = day;
                    checkbox.checked = currentFiltersPayment.date.includes(day);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${day}日`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFiltersPayment.date = selectedValues;
                applyDateFilterPayment();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFiltersPayment.date = [];
                applyDateFilterPayment();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function showDateFilterDropdownShipping(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 获取所有日期并提取年、月、日
            const dates = paymentDataShipping.map(item => item.date);
            const years = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[0] : null;
            }))].filter(Boolean).sort().reverse();
            
            const months = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[1] : null;
            }))].filter(Boolean).sort().reverse();
            
            const days = [...new Set(dates.map(date => {
                const parts = date.split('/');
                return parts.length === 3 ? parts[2] : null;
            }))].filter(Boolean).sort().reverse();
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加年份筛选
            if (years.length > 0) {
                const yearHeader = document.createElement('div');
                yearHeader.className = 'filter-item';
                yearHeader.style.fontWeight = 'bold';
                yearHeader.textContent = '按年筛选:';
                dropdown.appendChild(yearHeader);
                
                years.forEach(year => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = year;
                    checkbox.checked = currentFiltersShipping.date.includes(year);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${year}年`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加月份筛选
            if (months.length > 0) {
                const monthHeader = document.createElement('div');
                monthHeader.className = 'filter-item';
                monthHeader.style.fontWeight = 'bold';
                monthHeader.textContent = '按月筛选:';
                dropdown.appendChild(monthHeader);
                
                months.forEach(month => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = month;
                    checkbox.checked = currentFiltersShipping.date.includes(month);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${month}月`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加日期筛选
            if (days.length > 0) {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'filter-item';
                dayHeader.style.fontWeight = 'bold';
                dayHeader.textContent = '按日筛选:';
                dropdown.appendChild(dayHeader);
                
                days.forEach(day => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'filter-checkbox';
                    checkbox.value = day;
                    checkbox.checked = currentFiltersShipping.date.includes(day);
                    
                    item.appendChild(checkbox);
                    item.appendChild(document.createTextNode(`${day}日`));
                    dropdown.appendChild(item);
                });
            }
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFiltersShipping.date = selectedValues;
                applyDateFilterShipping();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFiltersShipping.date = [];
                applyDateFilterShipping();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        // 应用日期筛选
        function applyDateFilter() {
            let filteredData = [...paymentData];
            
            // 按日期筛选
            if (currentFilters.date.length > 0) {
                filteredData = filteredData.filter(item => {
                    const dateParts = item.date.split('/');
                    return currentFilters.date.some(filter => 
                        dateParts.includes(filter)
                    );
                });
            }
            
            renderPaymentTable(filteredData);
        }
        
        function applyDateFilterProducts() {
            let filteredData = [...paymentDataProducts];
            
            // 按日期筛选
            if (currentFiltersProducts.date.length > 0) {
                filteredData = filteredData.filter(item => {
                    const dateParts = item.date.split('/');
                    return currentFiltersProducts.date.some(filter => 
                        dateParts.includes(filter)
                    );
                });
            }
            
            renderPaymentTableProducts(filteredData);
        }
        
        function applyDateFilterPayment() {
            let filteredData = [...paymentDataPayment];
            
            // 按日期筛选
            if (currentFiltersPayment.date.length > 0) {
                filteredData = filteredData.filter(item => {
                    const dateParts = item.date.split('/');
                    return currentFiltersPayment.date.some(filter => 
                        dateParts.includes(filter)
                    );
                });
            }
            
            renderPaymentTablePayment(filteredData);
        }
        
        function applyDateFilterShipping() {
            let filteredData = [...paymentDataShipping];
            
            // 按日期筛选
            if (currentFiltersShipping.date.length > 0) {
                filteredData = filteredData.filter(item => {
                    const dateParts = item.date.split('/');
                    return currentFiltersShipping.date.some(filter => 
                        dateParts.includes(filter)
                    );
                });
            }
            
            renderPaymentTableShipping(filteredData);
        }
        
        // 清除所有筛选
        function clearAllFilters() {
            currentFilters = {
                date: [],
                type: [],
                form: [],
                settlement: [],
                description: []
            };
            renderPaymentTable();
        }
        
        function clearAllFiltersProducts() {
            currentFiltersProducts = {
                date: [],
                productName: [],
                color: [],
                quantity: [],
                unit: [],
                unitPrice: [],
                exchangeRate: [],
                rublePrice: [],
                cnyAmount: [],
                rubleAmount: [],
                description: []
            };
            renderPaymentTableProducts();
        }
        
        function clearAllFiltersPayment() {
            currentFiltersPayment = {
                date: [],
                recipient: [],
                account: [],
                method: [],
                amount: [],
                settlement: [],
                notes: []
            };
            renderPaymentTablePayment();
        }
        
        function clearAllFiltersShipping() {
            currentFiltersShipping = {
                date: [],
                product: [],
                code: [],
                quantity: [],
                weight: [],
                volume: [],
                fee: [],
                currency: [],
                exchangeRate: [],
                rubleEquivalent: [],
                palletFee: [],
                cubeFee: [],
                deliveryFee: [],
                total: [],
                settlement: [],
                notes: []
            };
            renderPaymentTableShipping();
        }
        
        // 其他列多选筛选函数
        function showFilterDropdown(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 获取列的所有值
            const values = [...new Set(paymentData.map(item => item[column]))].filter(v => v);
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加各值选项
            values.forEach(value => {
                const item = document.createElement('div');
                item.className = 'filter-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'filter-checkbox';
                checkbox.value = value;
                checkbox.checked = currentFilters[column].includes(value);
                
                item.appendChild(checkbox);
                item.appendChild(document.createTextNode(value));
                dropdown.appendChild(item);
            });
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFilters[column] = selectedValues;
                applyFilter();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFilters[column] = [];
                applyFilter();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function showFilterDropdownProducts(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 获取列的所有值
            const values = [...new Set(paymentDataProducts.map(item => item[column]))].filter(v => v);
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加各值选项
            values.forEach(value => {
                const item = document.createElement('div');
                item.className = 'filter-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'filter-checkbox';
                checkbox.value = value;
                checkbox.checked = currentFiltersProducts[column].includes(value);
                
                item.appendChild(checkbox);
                item.appendChild(document.createTextNode(value));
                dropdown.appendChild(item);
            });
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFiltersProducts[column] = selectedValues;
                applyFilterProducts();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFiltersProducts[column] = [];
                applyFilterProducts();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function showFilterDropdownPayment(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 获取列的所有值
            const values = [...new Set(paymentDataPayment.map(item => item[column]))].filter(v => v);
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加各值选项
            values.forEach(value => {
                const item = document.createElement('div');
                item.className = 'filter-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'filter-checkbox';
                checkbox.value = value;
                checkbox.checked = currentFiltersPayment[column].includes(value);
                
                item.appendChild(checkbox);
                item.appendChild(document.createTextNode(value));
                dropdown.appendChild(item);
            });
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFiltersPayment[column] = selectedValues;
                applyFilterPayment();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFiltersPayment[column] = [];
                applyFilterPayment();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function showFilterDropdownShipping(button, column) {
            // 移除现有下拉框
            const existing = document.querySelector('.filter-dropdown');
            if (existing) {
                existing.remove();
            }
            
            // 获取列的所有值
            const values = [...new Set(paymentDataShipping.map(item => item[column]))].filter(v => v);
            
            // 创建下拉框
            const dropdown = document.createElement('div');
            dropdown.className = 'filter-dropdown';
            
            // 添加各值选项
            values.forEach(value => {
                const item = document.createElement('div');
                item.className = 'filter-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'filter-checkbox';
                checkbox.value = value;
                checkbox.checked = currentFiltersShipping[column].includes(value);
                
                item.appendChild(checkbox);
                item.appendChild(document.createTextNode(value));
                dropdown.appendChild(item);
            });
            
            // 添加操作按钮
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            
            const applyBtn = document.createElement('button');
            applyBtn.className = 'filter-apply-btn';
            applyBtn.textContent = '应用筛选';
            applyBtn.addEventListener('click', function() {
                // 获取选中的筛选条件
                const selectedValues = Array.from(dropdown.querySelectorAll('.filter-checkbox:checked')).map(cb => cb.value);
                currentFiltersShipping[column] = selectedValues;
                applyFilterShipping();
                dropdown.remove();
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'filter-clear-btn';
            clearBtn.textContent = '清除筛选';
            clearBtn.addEventListener('click', function() {
                currentFiltersShipping[column] = [];
                applyFilterShipping();
                dropdown.remove();
            });
            
            actions.appendChild(applyBtn);
            actions.appendChild(clearBtn);
            dropdown.appendChild(actions);
            
            // 定位下拉框
            const rect = button.getBoundingClientRect();
            dropdown.style.top = (rect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (rect.left + window.scrollX) + 'px';
            
            document.body.appendChild(dropdown);
            
            // 点击其他地方时关闭下拉框
            document.addEventListener('click', function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        // 应用多选筛选
        function applyFilter() {
            let filteredData = [...paymentData];
            
            Object.keys(currentFilters).forEach(column => {
                if (currentFilters[column].length > 0) {
                    filteredData = filteredData.filter(item => 
                        currentFilters[column].includes(item[column])
                    );
                }
            });
            
            renderPaymentTable(filteredData);
        }
        
        function applyFilterProducts() {
            let filteredData = [...paymentDataProducts];
            
            Object.keys(currentFiltersProducts).forEach(column => {
                if (currentFiltersProducts[column].length > 0) {
                    filteredData = filteredData.filter(item => 
                        currentFiltersProducts[column].includes(item[column])
                    );
                }
            });
            
            renderPaymentTableProducts(filteredData);
        }
        
        function applyFilterPayment() {
            let filteredData = [...paymentDataPayment];
            
            Object.keys(currentFiltersPayment).forEach(column => {
                if (currentFiltersPayment[column].length > 0) {
                    filteredData = filteredData.filter(item => 
                        currentFiltersPayment[column].includes(item[column])
                    );
                }
            });
            
            renderPaymentTablePayment(filteredData);
        }
        
        function applyFilterShipping() {
            let filteredData = [...paymentDataShipping];
            
            Object.keys(currentFiltersShipping).forEach(column => {
                if (currentFiltersShipping[column].length > 0) {
                    filteredData = filteredData.filter(item => 
                        currentFiltersShipping[column].includes(item[column])
                    );
                }
            });
            
            renderPaymentTableShipping(filteredData);
        }
        
        // 初始化应用
        initData();
    </script>
</body>
</html>